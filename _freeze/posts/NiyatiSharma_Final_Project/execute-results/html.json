{
  "hash": "bf73f5743b35d14fa47f6aaaea8292eb",
  "result": {
    "markdown": "---\ntitle: \"Final Project\"\nauthor: \"Niyati Sharma\"\ndescription: Final project\ndate: \"12/20/2022\"\nformat:\n  html:\n    toc: true\n    code-fold: true\n    code-copy: true\n    code-tools: true\ncategories:\n  - finalpart\n  - Niyati Sharma\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'tidyverse' was built under R version 4.2.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──\n✔ ggplot2 3.4.0      ✔ purrr   0.3.5 \n✔ tibble  3.1.8      ✔ dplyr   1.0.10\n✔ tidyr   1.2.1      ✔ stringr 1.4.1 \n✔ readr   2.1.2      ✔ forcats 0.5.2 \n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'ggplot2' was built under R version 4.2.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'purrr' was built under R version 4.2.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\n```\n:::\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(cowplot)\nlibrary(caret)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'caret' was built under R version 4.2.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: lattice\n\nAttaching package: 'caret'\n\nThe following object is masked from 'package:purrr':\n\n    lift\n```\n:::\n\n```{.r .cell-code}\nlibrary(ROCR)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'ROCR' was built under R version 4.2.2\n```\n:::\n\n```{.r .cell-code}\nlibrary(rpart)\nlibrary(rpart.plot)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'rpart.plot' was built under R version 4.2.2\n```\n:::\n\n```{.r .cell-code}\nlibrary(rattle)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'rattle' was built under R version 4.2.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: bitops\nRattle: A free graphical interface for data science with R.\nVersion 5.5.1 Copyright (c) 2006-2021 Togaware Pty Ltd.\nType 'rattle()' to shake, rattle, and roll your data.\n```\n:::\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(plotly)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'plotly' was built under R version 4.2.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'plotly'\n\nThe following object is masked from 'package:ggplot2':\n\n    last_plot\n\nThe following object is masked from 'package:stats':\n\n    filter\n\nThe following object is masked from 'package:graphics':\n\n    layout\n```\n:::\n\n```{.r .cell-code}\nknitr::opts_chunk$set(echo = TRUE)\n```\n:::\n\n\n## Introduction\n\nCredit risk is defined as the risk of loss resulting from the failure by a borrower to repay the principal and interest owed to the leader.So the purpose of credit analysis is to determine the creditworthiness of borrowers by measuring the risk of loss that the lender is exposed to.When calculating the credit risk of a particular borrower, lenders consider various factors like analyze different documents, such as the borrower’s income statement, balance sheet, credit reports, and other documents that reveal the financial situation of the borrower to evaluate the characteristics of the borrower and conditions of the loan to estimate the financial loss.\n\n## Research Question\n\nQ1. How credit risk depends on the age of the person?\n\nThe purpose of this project is to take a data set of loan applications and build a predictive model for making a decision as to whether to approve a loan based on the applicant’s profile. \n\n## Hypothesis\n\nFor this research, the quantitative data was used. Based on probability techniques, this research has chosen to use random sampling method  based on documents and records of applicants for a German credit. In this study dependent variables are divided in two groups. Good and bad legal customers; the aim of this study is to estimate the important independent variables. In this regard, good customer is a company which repays its loan plus the profit at the due date and in contrast, bad customer is a company which don’t repay at the due date. To differentiate between good and bad customers in our statistical analysis calculations, 1 is illustrating good customers and 0 is illustrating bad customers.\n\nH0: There is a no relationship between age and credit risk.\nHA: There is a relationship between age and credit risk.\n\n\n## Dataset\n\nThe data for the analysis is a set of 1000 German credit applications with 20 different attributes of the applicant. The original data is from the UCI Machine Learning Repository but the CSV version used in this analysis can be found from the Penn State University website (https://onlinecourses.science.psu.edu/stat857/node/215).\n\nThe following code can be used to determine if an applicant is credit worthy and if he (or she) represents a good credit risk to the lender. Several methods are applied to the data to help make this determination. We will look at them in this case.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readr)\ncredit <- read_csv(\"_data/german_credit.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 1000 Columns: 21\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\ndbl (21): Creditability, Account Balance, Duration of Credit (month), Paymen...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n\n```{.r .cell-code}\nstr(credit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nspc_tbl_ [1,000 × 21] (S3: spec_tbl_df/tbl_df/tbl/data.frame)\n $ Creditability                    : num [1:1000] 1 1 1 1 1 1 1 1 1 1 ...\n $ Account Balance                  : num [1:1000] 1 1 2 1 1 1 1 1 4 2 ...\n $ Duration of Credit (month)       : num [1:1000] 18 9 12 12 12 10 8 6 18 24 ...\n $ Payment Status of Previous Credit: num [1:1000] 4 4 2 4 4 4 4 4 4 2 ...\n $ Purpose                          : num [1:1000] 2 0 9 0 0 0 0 0 3 3 ...\n $ Credit Amount                    : num [1:1000] 1049 2799 841 2122 2171 ...\n $ Value Savings/Stocks             : num [1:1000] 1 1 2 1 1 1 1 1 1 3 ...\n $ Length of current employment     : num [1:1000] 2 3 4 3 3 2 4 2 1 1 ...\n $ Instalment per cent              : num [1:1000] 4 2 2 3 4 1 1 2 4 1 ...\n $ Sex & Marital Status             : num [1:1000] 2 3 2 3 3 3 3 3 2 2 ...\n $ Guarantors                       : num [1:1000] 1 1 1 1 1 1 1 1 1 1 ...\n $ Duration in Current address      : num [1:1000] 4 2 4 2 4 3 4 4 4 4 ...\n $ Most valuable available asset    : num [1:1000] 2 1 1 1 2 1 1 1 3 4 ...\n $ Age (years)                      : num [1:1000] 21 36 23 39 38 48 39 40 65 23 ...\n $ Concurrent Credits               : num [1:1000] 3 3 3 3 1 3 3 3 3 3 ...\n $ Type of apartment                : num [1:1000] 1 1 1 1 2 1 2 2 2 1 ...\n $ No of Credits at this Bank       : num [1:1000] 1 2 1 2 2 2 2 1 2 1 ...\n $ Occupation                       : num [1:1000] 3 3 2 2 2 2 2 2 1 1 ...\n $ No of dependents                 : num [1:1000] 1 2 1 2 1 2 1 2 1 1 ...\n $ Telephone                        : num [1:1000] 1 1 1 1 1 1 1 1 1 1 ...\n $ Foreign Worker                   : num [1:1000] 1 1 1 2 2 2 2 2 1 1 ...\n - attr(*, \"spec\")=\n  .. cols(\n  ..   Creditability = col_double(),\n  ..   `Account Balance` = col_double(),\n  ..   `Duration of Credit (month)` = col_double(),\n  ..   `Payment Status of Previous Credit` = col_double(),\n  ..   Purpose = col_double(),\n  ..   `Credit Amount` = col_double(),\n  ..   `Value Savings/Stocks` = col_double(),\n  ..   `Length of current employment` = col_double(),\n  ..   `Instalment per cent` = col_double(),\n  ..   `Sex & Marital Status` = col_double(),\n  ..   Guarantors = col_double(),\n  ..   `Duration in Current address` = col_double(),\n  ..   `Most valuable available asset` = col_double(),\n  ..   `Age (years)` = col_double(),\n  ..   `Concurrent Credits` = col_double(),\n  ..   `Type of apartment` = col_double(),\n  ..   `No of Credits at this Bank` = col_double(),\n  ..   Occupation = col_double(),\n  ..   `No of dependents` = col_double(),\n  ..   Telephone = col_double(),\n  ..   `Foreign Worker` = col_double()\n  .. )\n - attr(*, \"problems\")=<externalptr> \n```\n:::\n:::\n\n1=Male Divorced\t\n2=Male Single\t\n3=Male, Married/Widowed\t\n4=Female\n\n\n# Data cleaning\n\nThere are columns which contain spaces so removed spaces, rename column names. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n#handle spaces in column name\nCredit_new1 <- credit                # Duplicate data\ncolnames(Credit_new1) <- gsub(\" \", \".\", colnames(Credit_new1))\n # Rename variable names\ncolnames(Credit_new1)[colnames(Credit_new1)\n                   %in% c(\"Duration.of.Credit.(month)\",\"Value.Savings/Stocks\",\"Sex.&.Marital.Status\",\"Age.(years)\")] <- c(\"Duration.of.Credit.month\",\"Value.Savings.Stocks\",\"Sex.Marital.Status\", \"Age.years\")\nCredit_new1  \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1,000 × 21\n   Creditability Accou…¹ Durat…² Payme…³ Purpose Credi…⁴ Value…⁵ Lengt…⁶ Insta…⁷\n           <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl>\n 1             1       1      18       4       2    1049       1       2       4\n 2             1       1       9       4       0    2799       1       3       2\n 3             1       2      12       2       9     841       2       4       2\n 4             1       1      12       4       0    2122       1       3       3\n 5             1       1      12       4       0    2171       1       3       4\n 6             1       1      10       4       0    2241       1       2       1\n 7             1       1       8       4       0    3398       1       4       1\n 8             1       1       6       4       0    1361       1       2       2\n 9             1       4      18       4       3    1098       1       1       4\n10             1       2      24       2       3    3758       3       1       1\n# … with 990 more rows, 12 more variables: Sex.Marital.Status <dbl>,\n#   Guarantors <dbl>, Duration.in.Current.address <dbl>,\n#   Most.valuable.available.asset <dbl>, Age.years <dbl>,\n#   Concurrent.Credits <dbl>, Type.of.apartment <dbl>,\n#   No.of.Credits.at.this.Bank <dbl>, Occupation <dbl>, No.of.dependents <dbl>,\n#   Telephone <dbl>, Foreign.Worker <dbl>, and abbreviated variable names\n#   ¹​Account.Balance, ²​Duration.of.Credit.month, …\n```\n:::\n:::\n\n\n\nConverting the columns to numeric.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfor(i in 1:21){\nCredit_new1[,i] <- as.numeric(unlist(Credit_new1[,i]))}\nprint(Credit_new1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1,000 × 21\n   Creditability Accou…¹ Durat…² Payme…³ Purpose Credi…⁴ Value…⁵ Lengt…⁶ Insta…⁷\n           <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl>\n 1             1       1      18       4       2    1049       1       2       4\n 2             1       1       9       4       0    2799       1       3       2\n 3             1       2      12       2       9     841       2       4       2\n 4             1       1      12       4       0    2122       1       3       3\n 5             1       1      12       4       0    2171       1       3       4\n 6             1       1      10       4       0    2241       1       2       1\n 7             1       1       8       4       0    3398       1       4       1\n 8             1       1       6       4       0    1361       1       2       2\n 9             1       4      18       4       3    1098       1       1       4\n10             1       2      24       2       3    3758       3       1       1\n# … with 990 more rows, 12 more variables: Sex.Marital.Status <dbl>,\n#   Guarantors <dbl>, Duration.in.Current.address <dbl>,\n#   Most.valuable.available.asset <dbl>, Age.years <dbl>,\n#   Concurrent.Credits <dbl>, Type.of.apartment <dbl>,\n#   No.of.Credits.at.this.Bank <dbl>, Occupation <dbl>, No.of.dependents <dbl>,\n#   Telephone <dbl>, Foreign.Worker <dbl>, and abbreviated variable names\n#   ¹​Account.Balance, ²​Duration.of.Credit.month, …\n```\n:::\n:::\n\n\n## Exploratory analysis\n\nBefore starting the modeling phase, it is important to explore the data to get an idea of any patterns or areas of interest.\n\nThe first thing is to examine how many examples of good and bad credit risk there are.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nPlot1 <- ggplot(Credit_new1, aes(as.factor(Creditability))) +\n        geom_bar(fill = \"pink\") +\n        theme(axis.title.x=element_blank()) + \n        theme(axis.title.y=element_blank()) +\n        geom_text(aes(label=..count..),stat='count',\n                  position=position_dodge(0.9),vjust=-0.2) +\n        scale_y_continuous(breaks=seq(0,700,100)) +\n        scale_x_discrete(labels = c(\"Bad\",\"Good\")) +\n        ggtitle(\"Count of Good and Bad Credit Risks\")\nPlot1\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: The dot-dot notation (`..count..`) was deprecated in ggplot2 3.4.0.\nℹ Please use `after_stat(count)` instead.\n```\n:::\n\n::: {.cell-output-display}\n![](NiyatiSharma_Final_Project_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nThe plot shows 300 people are of bad credit risk applicants versus 700 good. This is something that should be noted later when splitting the data set into training and test sets.\n\nThe next step is to explore some of the variables in the data. For example, it might be a fair assumption that amount of total savings is strongly linked to the credit risk of the applicant i.e. an applicant with little money in their account is a higher credit risk than one with a lot of savings? Another plot can be produced to confirm this.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot1 <- ggplot(Credit_new1, aes(as.factor(Value.Savings.Stocks), fill = as.factor(Creditability)),           stat=\"identity\") +\n        geom_bar() +\n        scale_fill_manual(values = c(\"blue\", \"orange\"),                    labels=c(\"Bad\",\"Good\"),name = \"Creditability\") +\n        theme(axis.title.x=element_blank()) +\n        theme(axis.title.y=element_blank()) +\n        scale_y_continuous(breaks=seq(0,700,100)) +\n        scale_x_discrete(labels = c(\"< 100 DM\", \"100-500 DM\", \"500-1000 DM\", \"> 1000 DM\", \"Unknown\")) +\n        \n        theme(axis.text.x = element_text(angle = 45, hjust = 1, size =         10)) + \n        theme(axis.text.y = element_text(size = 10)) +\n        theme(legend.text=element_text(size=10)) +\n        theme(legend.title=element_text(size=12)) +\n        ggtitle(\"Good and Bad Credit Risks by Credit History\")\nplot1\n```\n\n::: {.cell-output-display}\n![](NiyatiSharma_Final_Project_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\nThe plot seems to back up the rationale. A higher percentage of applicants with less savings are deemed as having bad credit risk.\n\nAnother area to explore is how credit risk relates to employment status. There are four statuses for employment in the data:\n\nUnemployed/ Unskilled (non-resident)\nUnskilled (resident)\nSkilled employee / Official\nManagement / Self-employed / Highly Qualified Employee / Officer\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot2 <- ggplot(Credit_new1, aes(as.factor(Occupation), fill = as.factor(Creditability)), stat=\"identity\") +\n        geom_bar() +\n        scale_fill_manual(values = c(\"blue\", \"green\"), labels=c(\"Bad\",\"Good\"),name = \"Creditability\") +\n        theme(axis.title.x=element_blank()) +\n        theme(axis.title.y=element_blank()) +\n        scale_y_continuous(breaks=seq(0,700,100)) +\n        scale_x_discrete(labels = c(\"Unemployed\", \"Unskilled\", \"Skilled\", \"Management\")) +\n        theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 10)) + \n        theme(axis.text.y = element_text(size = 10)) +\n        theme(legend.text=element_text(size=10)) +\n        theme(legend.title=element_text(size=12)) +\n        ggtitle(\"Good and Bad Credit Risks by Occupation\")\nplot2\n```\n\n::: {.cell-output-display}\n![](NiyatiSharma_Final_Project_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\nThere appears to be less of a link with occupation. Most of the applicants come under ‘skilled employee’ but the credit ability of unskilled employees and management/highly qualified employees does not appear significantly different. However further statistical modeling is needed to support this initial analysis.\n\nFinally, some exploration can be performed on age.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot3 <- ggplot(Credit_new1, aes(as.factor(Age.years), fill = as.factor(Creditability)), stat=\"identity\") +\n        geom_bar() +\n        scale_fill_manual(values = c(\"pink\", \"green\"), labels=c(\"Bad\",\"Good\"),name = \"Creditability\") +\n        theme(axis.title.x=element_blank()) +\n        theme(axis.title.y=element_blank()) +\n        scale_y_continuous(breaks=seq(0,70,5)) +\n  #      scale_x_discrete(labels = c(\"18-25\", \"26-40\", \"41-60\", \"60+\")) +\n        theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 10)) + \n        theme(axis.text.y = element_text(size = 10)) +\n        theme(legend.text=element_text(size=10)) +\n        theme(legend.title=element_text(size=12)) +\n        ggtitle(\"Good and Bad Credit Risks by Age\")\n\nplot3\n```\n\n::: {.cell-output-display}\n![](NiyatiSharma_Final_Project_files/figure-html/unnamed-chunk-8-1.png){width=1152}\n:::\n:::\n\nThis analysis indicates perhaps some decrease in credit risk with age. However there is probably a lot of correlation between age and other factors such as savings and property so further statistical analysis is needed.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nboxplot( Credit_new1$Age.years~Credit_new1$Creditability, col = \"green\", xlab = \"Creditability\", ylab = \"Age (in years)\")\n```\n\n::: {.cell-output-display}\n![](NiyatiSharma_Final_Project_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\nFrom the above box plot, we could see the median values of Good Creditability is more than Bad Creditability. Hence, Age will predict good credit risk. Now, if we see there are outliers in the data for both bad and good creditability, thus, it can impact the overall predictions. \n\n## Statistical modeling\n\n# Linear Regression with Age :\n\nA linear regression is a statistical model that analyzes the relationship between a response variable (often called y) and one or more variables and their interactions (often called x or explanatory variables).\nHere we are calculating age relation with credit risk. Age is a independent variable (x) and credit risk is the dependent variable (y)\n\n1. Perform OLS Regression\n\n\n::: {.cell}\n\n```{.r .cell-code}\nAge <- Credit_new1$Age.years\nCredit_risk <- Credit_new1$Creditability\nplot(Age,Credit_risk, main = \"Linearity Plot\", cex.main = 0.8)\n#fit simple linear regression model\nmodel <- lm(Credit_risk~Age)\nabline(model, col = 'red')\n```\n\n::: {.cell-output-display}\n![](NiyatiSharma_Final_Project_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\nFrom the plot we can see that the relationship doesn't appear to be linear.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#view model summary\nsummary(model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = Credit_risk ~ Age)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-0.8418 -0.6575  0.2817  0.3204  0.3610 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept) 0.568989   0.047497  11.980  < 2e-16 ***\nAge         0.003686   0.001273   2.895  0.00387 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.4568 on 998 degrees of freedom\nMultiple R-squared:  0.008331,\tAdjusted R-squared:  0.007337 \nF-statistic: 8.384 on 1 and 998 DF,  p-value: 0.003868\n```\n:::\n:::\n\n*Here is how to interpret the rest of the model summary*:\n\n*Pr(>|t|)*: This is the p-value associated with the model coefficients. Since the p-value for age (0.00106) is significantly less than .05, we can say that there is a statistically significant association between age and credit risk(Credibility)\n\n*Multiple R-squared*: This number tells us the percentage of the variation in the Credibility can be explained by the age. In general, the larger the R-squared value of a regression model the better the predictor variables are able to predict the value of the response variable. In this case, 1% of the variation in Credibility can be explained age.\n\n2.Residual Plots:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(Age, resid(model), main = \"Residual vs Fitted Plot\", cex.main = 0.8)\nabline(h=0, col = 'red')\n```\n\n::: {.cell-output-display}\n![](NiyatiSharma_Final_Project_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n3. Histogram: \n\n\n::: {.cell}\n\n```{.r .cell-code}\nhist(resid(model))\n```\n\n::: {.cell-output-display}\n![](NiyatiSharma_Final_Project_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n\n4.Normal Q-Q plot:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#create Q-Q plot for residuals\nqqnorm(resid(model))\n\n#add a straight diagonal line to the plot\nqqline(resid(model)) \n```\n\n::: {.cell-output-display}\n![](NiyatiSharma_Final_Project_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\nBy seeing above plots for `Linear Regression`, we can deduce following inferences :\n\n* **Linearity Plot** : As we can see from the `Linearity Plot`, the linear regression line doesn't follow the data points. As, the data points are categorical, hence, linearity line doesn't fit well. \n\n* **Constant Variance** : Now, when we see `Residual Vs Fitted Plot`, the residuals seems to follow a pattern over zero residual line and hence, we can conclude that it doesn't have constant variance.\n\n* **Data have normal distribution** : By seeing the histogram and QQ-plot, as we can see that histogram is not bell shaped or normally distributed and for QQ-plot, the data points don't follow the QQ-line. Therefore, it doesn't have normal distribution.\n\nAs we can see that non of above reasons support linearity and hence, Linear regression is not a good model to predict the relation between age and Creditability. Hence, we are implementing logistic regression for such data's. \n\n# Logistic regression\n\nLogistic regression (aka logit regression or logit model)is a regression model where the response variable Y is categorical. Logistic regression allows us to estimate the probability of a categorical response based on one or more predictor variables (X). It allows one to say that the presence of a predictor increases (or decreases) the probability of a given outcome by a specific percentage. When Y is binary — that is, where it can take only two values, “0” and “1”, which represent outcomes such as pass/fail, win/lose, good/bad or healthy/sick. Cases where the dependent variable has more than two outcome categories may be analysed with multinomial logistic regression, or, if the multiple categories are ordered, in ordinal logistic regression.\n\nSo here We need to build a logistic model that predicts the creditability either 0,1, based on the age of the person. The response variable is the binary variable Creditability and the predictor variable is Age.years. We build a logit model by applying the glm() function. For the logistic regression model we specify family = 'binomial’.\n\nThe first step before applying models is to create training and test data sets. The data will be split 70/30 and spread evenly between good and bad credit risks using the CreateDataPartition function in the caret package.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(2800)\ninTraining <- createDataPartition(Credit_new1$Creditability, p=0.7, list=FALSE)\ntrain <- Credit_new1[inTraining,]\ntest <- Credit_new1[-inTraining,]\n```\n:::\n\n\n**Model 1**\nThe first model of logistic regression using the glm() function where we are predicting creditability with all variables of the dataset.\nAnd We use the extractor function summary() to review the model properties.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlmModel_all <- glm(Creditability ~ ., family = binomial, data = Credit_new1)\nsummary(lmModel_all)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = Creditability ~ ., family = binomial, data = Credit_new1)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-2.5854  -0.7927   0.4512   0.7445   1.9483  \n\nCoefficients:\n                                    Estimate Std. Error z value Pr(>|z|)    \n(Intercept)                       -3.994e+00  1.024e+00  -3.901 9.58e-05 ***\nAccount.Balance                    5.799e-01  7.004e-02   8.280  < 2e-16 ***\nDuration.of.Credit.month          -2.457e-02  8.725e-03  -2.816 0.004862 ** \nPayment.Status.of.Previous.Credit  3.822e-01  8.740e-02   4.373 1.23e-05 ***\nPurpose                            3.153e-02  3.009e-02   1.048 0.294697    \nCredit.Amount                     -9.340e-05  4.012e-05  -2.328 0.019908 *  \nValue.Savings.Stocks               2.391e-01  5.827e-02   4.104 4.07e-05 ***\nLength.of.current.employment       1.517e-01  7.118e-02   2.132 0.033027 *  \nInstalment.per.cent               -2.983e-01  8.276e-02  -3.605 0.000312 ***\nSex.Marital.Status                 2.574e-01  1.157e-01   2.224 0.026131 *  \nGuarantors                         3.473e-01  1.777e-01   1.954 0.050681 .  \nDuration.in.Current.address       -1.411e-02  7.742e-02  -0.182 0.855335    \nMost.valuable.available.asset     -1.828e-01  9.101e-02  -2.009 0.044521 *  \nAge.years                          8.917e-03  8.206e-03   1.087 0.277218    \nConcurrent.Credits                 2.419e-01  1.111e-01   2.178 0.029420 *  \nType.of.apartment                  2.931e-01  1.677e-01   1.748 0.080527 .  \nNo.of.Credits.at.this.Bank        -2.436e-01  1.610e-01  -1.513 0.130257    \nOccupation                         1.889e-02  1.367e-01   0.138 0.890081    \nNo.of.dependents                  -1.708e-01  2.319e-01  -0.736 0.461567    \nTelephone                          2.947e-01  1.880e-01   1.567 0.117024    \nForeign.Worker                     1.158e+00  6.078e-01   1.906 0.056680 .  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 1221.73  on 999  degrees of freedom\nResidual deviance:  956.56  on 979  degrees of freedom\nAIC: 998.56\n\nNumber of Fisher Scoring iterations: 5\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(2800)\nlmModel_all <- glm(Creditability ~ ., family = binomial, data = train)\n\n# Fit model to test set\nlmFit_all <- predict(lmModel_all, type = \"response\", test)\n\n# Compare predictions to test set\nlmPred_all <- prediction(lmFit_all, test$Creditability)\n\n# Create Area Under the Curve (AUC) plot\nAUC <- performance(lmPred_all, 'tpr', 'fpr')\nplot(AUC,main = 'Creditability Vs All Independent Variables')\n```\n\n::: {.cell-output-display}\n![](NiyatiSharma_Final_Project_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(pROC)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'pROC' was built under R version 4.2.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nType 'citation(\"pROC\")' for a citation.\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'pROC'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:stats':\n\n    cov, smooth, var\n```\n:::\n\n```{.r .cell-code}\nroccurve <- roc(test$Creditability~lmFit_all)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nSetting levels: control = 0, case = 1\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nSetting direction: controls < cases\n```\n:::\n\n```{.r .cell-code}\nprint(auc(roccurve))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nArea under the curve: 0.7853\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nperformance(lmPred_all, measure = 'auc')@y.values[[1]]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.7853199\n```\n:::\n:::\n\n\n**Model 2**\nThe second model of logistic regression using the glm() function where we are predicting creditability with Age and other factors such as savings and property saving variables of the dataset.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlmModel_mul<- glm(Creditability ~ Age.years + Account.Balance+ Value.Savings.Stocks, family = binomial, data = Credit_new1)\nsummary(lmModel_mul)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = Creditability ~ Age.years + Account.Balance + Value.Savings.Stocks, \n    family = binomial, data = Credit_new1)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-2.4428  -1.0632   0.5425   0.8369   1.3564  \n\nCoefficients:\n                      Estimate Std. Error z value Pr(>|z|)    \n(Intercept)          -1.525681   0.290805  -5.246 1.55e-07 ***\nAge.years             0.015198   0.006709   2.265 0.023491 *  \nAccount.Balance       0.626635   0.064654   9.692  < 2e-16 ***\nValue.Savings.Stocks  0.183487   0.053213   3.448 0.000564 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 1221.7  on 999  degrees of freedom\nResidual deviance: 1074.4  on 996  degrees of freedom\nAIC: 1082.4\n\nNumber of Fisher Scoring iterations: 4\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(2800)\nlmModel_mul <- glm(Creditability ~ Age.years + Account.Balance+ Value.Savings.Stocks, family = binomial, data = train)\n# Fit model to test set\nlmFit_mul <- predict(lmModel_mul, type = \"response\", test)\n\n# Compare predictions to test set\nlmPred_mul <- prediction(lmFit_mul, test$Creditability)\n\n# Create Area Under the Curve (AUC) plot\nAUC <- performance(lmPred_mul, 'tpr', 'fpr')\nplot(AUC,main = 'Creditability Vs Age + Account Balance + Savings')\n```\n\n::: {.cell-output-display}\n![](NiyatiSharma_Final_Project_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(pROC)\nroccurve <- roc(test$Creditability~lmFit_mul)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nSetting levels: control = 0, case = 1\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nSetting direction: controls < cases\n```\n:::\n\n```{.r .cell-code}\nprint(auc(roccurve))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nArea under the curve: 0.699\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nperformance(lmPred_mul, measure = 'auc')@y.values[[1]]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.6989852\n```\n:::\n:::\n\n\n**Model 3***\nLogistic Regression with Age Years :\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlmModel_age <- glm(Creditability ~ Age.years, family = binomial, data = Credit_new1)\nsummary(lmModel_age)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = Creditability ~ Age.years, family = binomial, data = Credit_new1)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-1.8749  -1.4597   0.8093   0.8782   0.9544  \n\nCoefficients:\n            Estimate Std. Error z value Pr(>|z|)   \n(Intercept) 0.198456   0.233333   0.851   0.3950   \nAge.years   0.018512   0.006449   2.870   0.0041 **\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 1221.7  on 999  degrees of freedom\nResidual deviance: 1213.1  on 998  degrees of freedom\nAIC: 1217.1\n\nNumber of Fisher Scoring iterations: 4\n```\n:::\n:::\n\n\nLet us take a closer look on the coefficients:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(lmModel_age)$coefficients\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n              Estimate  Std. Error   z value   Pr(>|z|)\n(Intercept) 0.19845642 0.233332604 0.8505302 0.39503039\nAge.years   0.01851229 0.006449428 2.8703768 0.00409983\n```\n:::\n:::\n\nBy taking the exponent of the coefficient value, we get the odds ratio.\n\n::: {.cell}\n\n```{.r .cell-code}\nexp(coefficients(lmModel_age)[2])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAge.years \n 1.018685 \n```\n:::\n:::\n\nThe magnitude of the coefficient implies that for every degree increase in age the odds ratio increases on average by a constant factor of 1.018 (or approx 2%)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(2800)\nlmModel_age <- glm(Creditability ~ Age.years, family = binomial, data = train)\n# Fit model to test set\nlmFit_age <- predict(lmModel_age, type = \"response\", test)\n\n# Compare predictions to test set\nlmPred_age <- prediction(lmFit_age, test$Creditability)\n\n# Create Area Under the Curve (AUC) plot\nAUC <- performance(lmPred_age, 'tpr', 'fpr')\nplot(AUC,main = 'Creditability Vs Age (Area under Curve)', cex.main = 0.8)\n```\n\n::: {.cell-output-display}\n![](NiyatiSharma_Final_Project_files/figure-html/unnamed-chunk-27-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(pROC)\nroccurve <- roc(test$Creditability~lmFit_age)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nSetting levels: control = 0, case = 1\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nSetting direction: controls < cases\n```\n:::\n\n```{.r .cell-code}\nprint(auc(roccurve))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nArea under the curve: 0.5522\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nperformance(lmPred_age, measure = 'auc')@y.values[[1]]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.5521847\n```\n:::\n:::\n\n\n#Interpreting the results of our logistic regression model.\n\n**P-Value**\nNow we can analyze the fitting and interpret what the models are telling us.\nHere, it portrays that age is statistically significant variable as the p-value is less than 0.05 suggesting a strong association of the age with creditability. Therefore we can reject null hypothesis. However, if we are taking all independent variables then age’s relationship with creditability is nullify due to strong other dominating variables like Savings, Account Balance. Thus, we infer that older people have more savings and account balance which defines more creditability. \n  \n**Coefficient**\nThe coefficient of the age variable (Age.Years) has a positive sign of this value indicates that the chance of creditability increases with Age. By taking the exponent of the coefficient value, we get the odds ratio. The magnitude of the coefficient implies that for every degree increase in age the odds ratio increases on average by a constant factor of 1.018 (or approx 2%). In all three models creditability is increasing with age. So we can predict that there's a positive relation between age and creditability. \n\n**Model Comparison**\nWe are comparing our models on AUC\nThe Area Under the ROC curve (AUC) is an aggregated metric that evaluates how well a logistic regression model classifies positive and negative outcomes at all possible cutoffs. It can range from 0.5 to 1, and the larger it is the better.\nOn comparing Model 1,Model 2 and Model 3 based on AUC it shows Model 1 has a AUC (.78) higher than other 2 models Model 2 (.699) and Model 3 (.55).The higher AUC, shows the performance of the model 1 is better in distinguishing between the positive and negative classes comparing other 2 models.\n\n\n## References\n\n1. Credit Risk Analysis by Jack Sandom on German credit applications from 1994 (https://online.stat.psu.edu/stat857/node/215/)\n2.Gouvêa, M. A., & Gonçalves, E. B. (2007). Credit Risk Analysis Applying Logistic Regression, Neural Networks and Genetic Algorithms Models. Paper presented at the Production and Operations Management Society (POMS), Dallas, Texas, U.S.A.\n3.Angelini, E., di Tollo, G., & Roli, A. (2008). A neural network approach for credit risk evaluation. The Quarterly Review of Economics and Finance, 48(4), 733-755. http://dx.doi.org/10.1016/j.qref.2007.04.001.\n4.Eletter, S. F., & Yaseen, S. G. (2010). Applying Neural Networks for Loan Decisions in the Jordanian Commercial Banking System. International Journal of Computer Science and Network Security, 10(1), 209-214.\n5.Hornik, K., Stinchcombe, M., & White, H. (1989). Multilayer feed forward networks are universal approximators. Neural Networks, 2(5),359-366.http://dx.doi.org/10.1016/0893-6080(89)90020-8\n6.Ghodselahi, A., & Amirmadhi, A. (2011). Application of Artificial Intelligence Techniques for Credit Risk Evaluation. International Journal of Modeling and Optimization, 1(3), 243-249. http://dx.doi.org/10.7763/IJMO.2011.V1.43\n7.Jack Sandom (2017) https://rpubs.com/jssandom/credit-risk-analysis\n8.Beatty, A., and S. Liao. 2011. Do Delays in Expected Loss Recognition Affect Banks' Willingness to Lend? Journal of Accounting & Economics 52 (1): 1-20. DOI: 10.1016/j.jacceco.2011.02.002\n\n",
    "supporting": [
      "NiyatiSharma_Final_Project_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}