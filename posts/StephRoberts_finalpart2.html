<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Steph Roberts">
<meta name="dcterms.date" content="2022-10-09">

<title>Final Project: Diabetes Prediction - Part 2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../images/DACSS_Round_Network.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<meta name="twitter:title" content="Final Project: Diabetes Prediction - Part 2">
<meta name="twitter:description" content="According to the World Health Organization (WHO), an estimated 537 million people worldwide are living with diabetes. It is a leading cause of health complications and even death.">
<meta name="twitter:creator" content="@UMassDACSS">
<meta name="twitter:site" content="@UMassDACSS">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../images/UMass White Wordmark Horiz.png" alt="" class="navbar-logo">
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://dacss.github.io/603_Fall_2022/">
 <span class="menu-text">Fall 2022 Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html">
 <span class="menu-text">Contributors</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://umass.edu/sbs/dacss">
 <span class="menu-text">DACSS</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/DACSS/603_Fall_2022"><i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#diabetes-risk-factors" id="toc-diabetes-risk-factors" class="nav-link active" data-scroll-target="#diabetes-risk-factors">Diabetes risk factors</a></li>
  <li><a href="#research-question" id="toc-research-question" class="nav-link" data-scroll-target="#research-question">Research Question</a></li>
  <li><a href="#hypothesis" id="toc-hypothesis" class="nav-link" data-scroll-target="#hypothesis">Hypothesis</a></li>
  <li><a href="#descriptive-statistics" id="toc-descriptive-statistics" class="nav-link" data-scroll-target="#descriptive-statistics">Descriptive Statistics</a></li>
  <li><a href="#hypothesis-testing" id="toc-hypothesis-testing" class="nav-link" data-scroll-target="#hypothesis-testing">Hypothesis Testing</a>
  <ul class="collapse">
  <li><a href="#diagnostics" id="toc-diagnostics" class="nav-link" data-scroll-target="#diagnostics">Diagnostics</a></li>
  </ul></li>
  <li><a href="#model-comparisons" id="toc-model-comparisons" class="nav-link" data-scroll-target="#model-comparisons">Model Comparisons</a>
  <ul class="collapse">
  <li><a href="#model-1" id="toc-model-1" class="nav-link" data-scroll-target="#model-1">Model 1</a></li>
  <li><a href="#model-2" id="toc-model-2" class="nav-link" data-scroll-target="#model-2">Model 2</a></li>
  <li><a href="#model-3" id="toc-model-3" class="nav-link" data-scroll-target="#model-3">Model 3</a></li>
  <li><a href="#model-4" id="toc-model-4" class="nav-link" data-scroll-target="#model-4">Model 4</a></li>
  <li><a href="#model-5" id="toc-model-5" class="nav-link" data-scroll-target="#model-5">Model 5</a></li>
  <li><a href="#choosing-a-model" id="toc-choosing-a-model" class="nav-link" data-scroll-target="#choosing-a-model">Choosing a model:</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Final Project: Diabetes Prediction - Part 2</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
  <div class="quarto-categories">
    <div class="quarto-category">finalproject</div>
    <div class="quarto-category">Steph Roberts</div>
    <div class="quarto-category">dataset</div>
    <div class="quarto-category">ggplot2</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Steph Roberts </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 9, 2022</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in library(pROC): there is no package called 'pROC'</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Hmisc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in library(Hmisc): there is no package called 'Hmisc'</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="diabetes-risk-factors" class="level3">
<h3 class="anchored" data-anchor-id="diabetes-risk-factors">Diabetes risk factors</h3>
<p>According to the World Health Organization (WHO), an estimated 537 million people worldwide are living with diabetes. It is a leading cause of health complications and even death. The WHO states close to 1.5 million people died due to diabetes and its complication in 2019 alone. It is a growing problem that requires dedicated research to aim at the slowdown and prevention of future cases.</p>
</section>
<section id="research-question" class="level2">
<h2 class="anchored" data-anchor-id="research-question">Research Question</h2>
<ol type="1">
<li>What risk factors are most predictive of diabetes?</li>
</ol>
<p>Research on Diabetes is ongoing and in-depth within the medical field. The prevalence and incidence of diabetes mellitus type 2 (DQ2) have increased consistently for decades, giving way to an increase in mortality related to diabetes. Commonly in the medical field, many risk factors are used to measure a patient’s risk of developing DM2, such as obesity, family history, hypertension and changes in fasting blood sugar levels. Moreno et al.&nbsp;(2018) studied risk parameters for diabetes and concluded “risk of being diabetic rises in patients whose father has suffered an acute myocardial infarction, in those whose mother or father is diabetic and in patients with a high waist perimeter.” Their focus on family history leaves room for studies more focused on individual medical factors, such as blood pressure, BMI, number of pregnancies, etc. That is the aim of this project.</p>
<p>M. L. M. V. J. A. (2018, June 11). Predictive risk model for the diagnosis of diabetes mellitus type 2 in a follow-up study 15 Years on: Prodi2 study. European journal of public health. Retrieved October 9, 2022, from https://pubmed.ncbi.nlm.nih.gov/29897477/</p>
<ol start="2" type="1">
<li>Can the use of regression analysis help predict risk of diabetes based on several medical variables?</li>
</ol>
<p>Other research, such as a Edlitz &amp; Segal (2022) study titled Prediction of type 2 diabetes mellitus onset using logistic regression-based scorecards, does focus on using individual medical factors to predict risk of diabetes through regression. This project aims to conduct similar analysis on different data.</p>
<p>E. Y. S. E. (2022, June 22). Prediction of type 2 diabetes mellitus onset using logistic regression-based scorecards. eLife. Retrieved October 9, 2022, from https://pubmed.ncbi.nlm.nih.gov/35731045/</p>
</section>
<section id="hypothesis" class="level2">
<h2 class="anchored" data-anchor-id="hypothesis">Hypothesis</h2>
<p>Body mass index (BMI), glucose, and age are positive predictors of diabetes mellitus type 2.</p>
<p>This hypothesis has been tested in the above mentioned studies. The contribution from this project will be the additional support for or against the hypotheses from the analysis of different data.</p>
</section>
<section id="descriptive-statistics" class="level2">
<h2 class="anchored" data-anchor-id="descriptive-statistics">Descriptive Statistics</h2>
<p>The data was collected by the “National Institute of Diabetes and Digestive and Kidney Diseases” as part of the Pima Indians Diabetes Database (PIDD). A total of 768 cases are available in PIDD. However, 5 patients had a glucose of 0 and 11 patients had a body mass index of 0. After cleaning the data by removing the cases with numbers that are incompatible with life in categories important to the current research, 752 cases remained. All patients belong to the Pima Indian heritage (subgroup of Native Americans), and are females aged 21 years and above.</p>
<p>The datasets consists of 9 medical predictor (independent) variables and one target (dependent) variable, outcome.</p>
<p><strong>Pregnancies:</strong> Number of times a woman has been pregnant<br>
<strong>Glucose:</strong> Plasma Glucose concentration of 2 hours in an oral glucose tolerance test<br>
<strong>BloodPressure:</strong> Diastolic Blood Pressure (mm hg)<br>
<strong>SkinThickness:</strong> Triceps skin fold thickness(mm)<br>
<strong>Insulin:</strong> 2 hour serum insulin(mu U/ml)<br>
<strong>BMI:</strong> Body Mass Index ((weight in kg/height in m)^2)<br>
<strong>Age:</strong> Age(years)<br>
<strong>DiabetesPedigreeFunction:</strong> scores likelihood of diabetes based on family history<br>
<strong>Outcome:</strong> 0 (doesn’t have diabetes) or 1 (has diabetes)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"_data/diabetes2.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 768 Columns: 9
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
dbl (9): Pregnancies, Glucose, BloodPressure, SkinThickness, Insulin, BMI, D...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 768   9</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Pregnancies        Glucose      BloodPressure    SkinThickness  
 Min.   : 0.000   Min.   :  0.0   Min.   :  0.00   Min.   : 0.00  
 1st Qu.: 1.000   1st Qu.: 99.0   1st Qu.: 62.00   1st Qu.: 0.00  
 Median : 3.000   Median :117.0   Median : 72.00   Median :23.00  
 Mean   : 3.845   Mean   :120.9   Mean   : 69.11   Mean   :20.54  
 3rd Qu.: 6.000   3rd Qu.:140.2   3rd Qu.: 80.00   3rd Qu.:32.00  
 Max.   :17.000   Max.   :199.0   Max.   :122.00   Max.   :99.00  
    Insulin           BMI        DiabetesPedigreeFunction      Age       
 Min.   :  0.0   Min.   : 0.00   Min.   :0.0780           Min.   :21.00  
 1st Qu.:  0.0   1st Qu.:27.30   1st Qu.:0.2437           1st Qu.:24.00  
 Median : 30.5   Median :32.00   Median :0.3725           Median :29.00  
 Mean   : 79.8   Mean   :31.99   Mean   :0.4719           Mean   :33.24  
 3rd Qu.:127.2   3rd Qu.:36.60   3rd Qu.:0.6262           3rd Qu.:41.00  
 Max.   :846.0   Max.   :67.10   Max.   :2.4200           Max.   :81.00  
    Outcome     
 Min.   :0.000  
 1st Qu.:0.000  
 Median :0.000  
 Mean   :0.349  
 3rd Qu.:1.000  
 Max.   :1.000  </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 9
  Pregnancies Glucose BloodPressure SkinTh…¹ Insulin   BMI Diabe…²   Age Outcome
        &lt;dbl&gt;   &lt;dbl&gt;         &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1           6     148            72       35       0  33.6   0.627    50       1
2           1      85            66       29       0  26.6   0.351    31       0
3           8     183            64        0       0  23.3   0.672    32       1
4           1      89            66       23      94  28.1   0.167    21       0
5           0     137            40       35     168  43.1   2.29     33       1
6           5     116            74        0       0  25.6   0.201    30       0
# … with abbreviated variable names ¹​SkinThickness, ²​DiabetesPedigreeFunction</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#check for null entries</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">is.null</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Check number of 0s in each column</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(df<span class="sc">==</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>             Pregnancies                  Glucose            BloodPressure 
                     111                        5                       35 
           SkinThickness                  Insulin                      BMI 
                     227                      374                       11 
DiabetesPedigreeFunction                      Age                  Outcome 
                       0                        0                      500 </code></pre>
</div>
</div>
<p>Glucose, blood pressure, skin thickness, insulin, BMI and Age are not variables that should logically have 0s. Those values, if true, are likely incompatible with life. To reduce the amount of data we exclude, we will only remove observations that have 0s for our explanatory variables. We will remove those cases from analysis.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Remove rows with 0 in respective columns</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df[<span class="fu">apply</span>(df[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">6</span>)],<span class="dv">1</span>,<span class="cf">function</span>(z) <span class="sc">!</span><span class="fu">any</span>(z<span class="sc">==</span><span class="dv">0</span>)),] </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Verify 0s are gone in selected rows</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(df<span class="sc">==</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>             Pregnancies                  Glucose            BloodPressure 
                     108                        0                       28 
           SkinThickness                  Insulin                      BMI 
                     218                      360                        0 
DiabetesPedigreeFunction                      Age                  Outcome 
                       0                        0                      488 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Check cleaned data frame</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 752
Columns: 9
$ Pregnancies              &lt;dbl&gt; 6, 1, 8, 1, 0, 5, 3, 10, 2, 4, 10, 10, 1, 5, …
$ Glucose                  &lt;dbl&gt; 148, 85, 183, 89, 137, 116, 78, 115, 197, 110…
$ BloodPressure            &lt;dbl&gt; 72, 66, 64, 66, 40, 74, 50, 0, 70, 92, 74, 80…
$ SkinThickness            &lt;dbl&gt; 35, 29, 0, 23, 35, 0, 32, 0, 45, 0, 0, 0, 23,…
$ Insulin                  &lt;dbl&gt; 0, 0, 0, 94, 168, 0, 88, 0, 543, 0, 0, 0, 846…
$ BMI                      &lt;dbl&gt; 33.6, 26.6, 23.3, 28.1, 43.1, 25.6, 31.0, 35.…
$ DiabetesPedigreeFunction &lt;dbl&gt; 0.627, 0.351, 0.672, 0.167, 2.288, 0.201, 0.2…
$ Age                      &lt;dbl&gt; 50, 31, 32, 21, 33, 30, 26, 29, 53, 30, 34, 5…
$ Outcome                  &lt;dbl&gt; 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 1, 1, …</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Summarize df</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Pregnancies        Glucose       BloodPressure   SkinThickness  
 Min.   : 0.000   Min.   : 44.00   Min.   :  0.0   Min.   : 0.00  
 1st Qu.: 1.000   1st Qu.: 99.75   1st Qu.: 64.0   1st Qu.: 0.00  
 Median : 3.000   Median :117.00   Median : 72.0   Median :23.00  
 Mean   : 3.851   Mean   :121.94   Mean   : 69.7   Mean   :20.72  
 3rd Qu.: 6.000   3rd Qu.:141.00   3rd Qu.: 80.0   3rd Qu.:32.00  
 Max.   :17.000   Max.   :199.00   Max.   :122.0   Max.   :99.00  
    Insulin            BMI        DiabetesPedigreeFunction      Age       
 Min.   :  0.00   Min.   :18.20   Min.   :0.0780           Min.   :21.00  
 1st Qu.:  0.00   1st Qu.:27.50   1st Qu.:0.2440           1st Qu.:24.00  
 Median : 39.00   Median :32.30   Median :0.3770           Median :29.00  
 Mean   : 81.35   Mean   :32.45   Mean   :0.4731           Mean   :33.31  
 3rd Qu.:130.00   3rd Qu.:36.60   3rd Qu.:0.6275           3rd Qu.:41.00  
 Max.   :846.00   Max.   :67.10   Max.   :2.4200           Max.   :81.00  
    Outcome      
 Min.   :0.0000  
 1st Qu.:0.0000  
 Median :0.0000  
 Mean   :0.3511  
 3rd Qu.:1.0000  
 Max.   :1.0000  </code></pre>
</div>
</div>
<p>At a glance, this summary is more fitting after having cleaned our data. An average of 3 pregnancies, considering our 21+ female population, makes sense. A mean glucose of 122, blood pressure of 70, a BMI of 33, and age of 33 are reasonably accurate for our population.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Rename columns</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"pregnancies"</span>, <span class="st">"glucose"</span>, <span class="st">"bp"</span>, <span class="st">"skin_thickness"</span>, <span class="st">"insulin"</span>, <span class="st">"bmi"</span>, <span class="st">"dpf"</span>, <span class="st">"age"</span>, <span class="st">"diabetes"</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 752   9</code></pre>
</div>
</div>
<p>We have 752 observations and 9 variables with which to work. The data is clean and ready for analysis.</p>
<p>Let’s get familiar with the data set by observing the histograms for each variable.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Scatterplot matrix</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="StephRoberts_finalpart2_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Histograms of each variable</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist.data.frame</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in hist.data.frame(df): could not find function "hist.data.frame"</code></pre>
</div>
</div>
<p>The scatterplot matix shows that our variables generally lack linear relationships. Logistics regression may be best for analyzing this type of data.</p>
<p>The histograms show us the distribution of all our variables. Pregnancies is right skewed with more women having a smaller number of pregnancies and a small number having over 10. Glucose appears to follow a close-to-normal distribution with the mean just over 100. BMI follows a similar pattern with a central value of just over 30. Age is right skewed with the majority of the sample appearing to be in their 20s and slower tapering off to ages in their 50s. This is a good place to start. The only variable we cannot view in a histogram is the outcome variable due to its binary nature as a dummy variable.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>bgap <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(df[, <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">8</span>,<span class="dv">9</span>)])</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(bgap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="StephRoberts_finalpart2_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot outcome variable</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">factor</span>(diabetes))) <span class="sc">+</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill =</span> <span class="st">"#0073C2FF"</span>)<span class="sc">+</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">'No Diabetes'</span>,<span class="st">'Diabetes'</span>))<span class="sc">+</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Outcome"</span>)<span class="sc">+</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> ..count..), <span class="at">stat =</span> <span class="st">"count"</span>, <span class="at">vjust =</span> <span class="fl">1.5</span>, <span class="at">colour =</span> <span class="st">"white"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The dot-dot notation (`..count..`) was deprecated in ggplot2 3.4.0.
ℹ Please use `after_stat(count)` instead.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="StephRoberts_finalpart2_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>About a third of our sample have diabetes, with 264 cases with diabetes and 488 without.</p>
</section>
<section id="hypothesis-testing" class="level2">
<h2 class="anchored" data-anchor-id="hypothesis-testing">Hypothesis Testing</h2>
<p>To test our hypothesis we could use either linear regression or logistics regression. Considering the outcome variable is binary, logistics regression is likely going to be best. First, though, let’s try to plot a linear regression as a type of diagnostics test.</p>
<section id="diagnostics" class="level3">
<h3 class="anchored" data-anchor-id="diagnostics">Diagnostics</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>dlm <span class="ot">&lt;-</span> <span class="fu">lm</span>(diabetes <span class="sc">~</span> bmi <span class="sc">+</span> glucose <span class="sc">+</span> age, <span class="at">data =</span> df)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Diagnostic plot of model</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dlm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="StephRoberts_finalpart2_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="StephRoberts_finalpart2_files/figure-html/unnamed-chunk-12-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="StephRoberts_finalpart2_files/figure-html/unnamed-chunk-12-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="StephRoberts_finalpart2_files/figure-html/unnamed-chunk-12-4.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Residuals vs Fitted</strong>: The residuals have 2 distinct patterns of behavior. This is likely due to our model representing two distinct outcomes. It therefore breaks normality.</p>
<p><strong>Normal Q-Q</strong>: The Q-Q plot, which indicates level of asymmetry, tells us our data is not a normal distribution. It appears to have a right tail (see the points drifting from the line at the top). It also has values away from the line on the bottom left, away from the intercept. This suggests our model also includes a left tail. This distribution seems to have “fat tails.”</p>
<p><strong>Scale-Location</strong>: This plots the fitted values of the model along the x-axis and the square root of the standardized residuals along the y-axis. There is a clear X pattern among residuals. This suggests our model has heteroscedasticity, which is not ideal.</p>
<p><strong>Residuals vs Leverage</strong>: The points on this graph all fall within Cook’s distance, indicating there are not any influential points in our regression model.</p>
<p><strong>Conclusion</strong>: A linear regression does not appear to be the best regression analysis to use for this data. Instead, we will work with logistics regression to test our hypothesis, then train and test the data.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create training and test data</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>bgap <span class="sc">%&gt;%</span> </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">multiply_by</span>(<span class="fl">0.7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>() <span class="ot">-&gt;</span> training_set_size</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>train_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df), training_set_size)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> bgap[train_indices,]</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> bgap[<span class="sc">-</span>train_indices,]</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 526</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 226</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    pregnancies glucose  bmi age diabetes
679           7     129 38.5  43        1
129           8      84 38.3  39        0
509           3     124 33.2  26        0
471           0     123 35.2  29        0
299           2     120 39.7  29        0
270           7     106 26.5  29        1</code></pre>
</div>
</div>
<p>Our hypothesis involves the BMI, glucose, and age variables. First we can take a look at them individually.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Logistics regression is best for binomial outcome variables </span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Regression model on BMI</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>mbmi <span class="ot">&lt;-</span> <span class="fu">glm</span>(diabetes <span class="sc">~</span> bmi, <span class="at">data =</span> train, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mbmi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = diabetes ~ bmi, family = binomial(link = "logit"), 
    data = train)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.8832  -0.9260  -0.6873   1.2627   1.8509  

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -3.63931    0.50474  -7.210 5.58e-13 ***
bmi          0.09121    0.01484   6.147 7.89e-10 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 679.74  on 525  degrees of freedom
Residual deviance: 637.46  on 524  degrees of freedom
AIC: 641.46

Number of Fisher Scoring iterations: 4</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(mbmi<span class="sc">$</span>coefficients)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)         bmi 
 0.02627038  1.09550006 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(train, <span class="fu">aes</span>(<span class="at">x =</span>bmi, <span class="at">y =</span> diabetes)) <span class="sc">+</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span>.<span class="dv">5</span>, <span class="at">col=</span><span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">'glm'</span>, <span class="at">se=</span><span class="cn">FALSE</span>, <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">family=</span>binomial))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="StephRoberts_finalpart2_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Interpretation: The exponentiation of the coefficient tells us that a 1-unit increase in BMI multiplies the odds of diabetes by 1.096. The residuals are relatively small. The coefficient estimate suggests that for every 1 unit increase of BMI, the chance of diabetes increases 0.091. The very small p-value of 5.58e-13 indicates we can reject the null hypothesis and conclude a relationship between BMI and diabetes.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Regression model on glucose </span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>mgluc <span class="ot">&lt;-</span> <span class="fu">glm</span>(diabetes <span class="sc">~</span> glucose, <span class="at">data =</span> train, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mgluc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = diabetes ~ glucose, family = binomial(link = "logit"), 
    data = train)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.1477  -0.7987  -0.5104   0.8687   2.2829  

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -5.629753   0.530848 -10.605   &lt;2e-16 ***
glucose      0.039752   0.004069   9.769   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 679.74  on 525  degrees of freedom
Residual deviance: 549.68  on 524  degrees of freedom
AIC: 553.68

Number of Fisher Scoring iterations: 4</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(mgluc<span class="sc">$</span>coefficients)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)     glucose 
0.003589462 1.040552225 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> train, <span class="fu">aes</span>(<span class="at">x =</span> glucose, <span class="at">y =</span> diabetes)) <span class="sc">+</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span>.<span class="dv">5</span>, <span class="at">col=</span><span class="st">"darkseagreen"</span>) <span class="sc">+</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">'glm'</span>, <span class="at">se=</span><span class="cn">FALSE</span>, <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">family=</span>binomial))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="StephRoberts_finalpart2_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Interpretation: The exponentiation of the coefficient tells us that a 1-unit increase in plasma glucose concentration multiplies the odds of diabetes by 1.040. With a very small p-value, &lt;2e-16, we can see that the plasma glucose concentrations of the 2 hour oral glucose tolerance test (GGT) are related to our outcome variable, diabetes. This makes sense as GGT is sometimes used as a diagnostic tool for diabetes.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Regression model on age</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>mage <span class="ot">&lt;-</span> <span class="fu">glm</span>(diabetes <span class="sc">~</span> age, <span class="at">data =</span> train, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mage)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = diabetes ~ age, family = binomial(link = "logit"), 
    data = train)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.6594  -0.8597  -0.7715   1.3214   1.6639  

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -1.85960    0.28150  -6.606 3.95e-11 ***
age          0.03637    0.00775   4.692 2.71e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 679.74  on 525  degrees of freedom
Residual deviance: 656.96  on 524  degrees of freedom
AIC: 660.96

Number of Fisher Scoring iterations: 4</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(mage<span class="sc">$</span>coefficients)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)         age 
  0.1557343   1.0370345 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> train, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> diabetes)) <span class="sc">+</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span>.<span class="dv">5</span>, <span class="at">col=</span><span class="st">"coral"</span>) <span class="sc">+</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">'glm'</span>, <span class="at">se=</span><span class="cn">FALSE</span>, <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">family=</span>binomial))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="StephRoberts_finalpart2_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Interpretation: The exponentiation of the coefficient tells us that a 1-unit increase in age (years) multiplies the odds of diabetes by 1.037. The estimate shows us that one unit increase of age (1 year), increases the l Similar to the previous variable, age has a small standard error. It shows a p-value of 2.71e-06, indicating a relationship between age and diabetes.</p>
<p>The hypothesis that BMI, glucose tolerance results, and age are positively associated with diabetes is supported. The small p-values show the variables are significant at 1% level of significance. We are able to reject the null hypothesis. Next, we can investigate models that could help predict the outcome using these variables.</p>
</section>
</section>
<section id="model-comparisons" class="level2">
<h2 class="anchored" data-anchor-id="model-comparisons">Model Comparisons</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Model 1 using all independent variables - pregnancies, glucose, bmi, age</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>all_var <span class="ot">&lt;-</span> <span class="fu">glm</span>(diabetes <span class="sc">~</span> ., <span class="at">data =</span> train, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Model 2 using BMI, glucose, and age</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>bga <span class="ot">&lt;-</span> <span class="fu">glm</span>(diabetes <span class="sc">~</span> . <span class="sc">-</span>pregnancies, <span class="at">data =</span> train, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Model 3 using BMI and glucose</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>bg <span class="ot">&lt;-</span> <span class="fu">glm</span>(diabetes <span class="sc">~</span> .<span class="sc">-</span>age <span class="sc">-</span>pregnancies, <span class="at">data =</span> train, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Model 4 using BMI, glucose, age, and an interaction between pregnancies and age.</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>ia <span class="ot">&lt;-</span> <span class="fu">glm</span>(diabetes <span class="sc">~</span> glucose <span class="sc">+</span> bmi <span class="sc">+</span> age<span class="sc">*</span>pregnancies, <span class="at">data =</span> train, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Model 5 with BMI, glucose, and pregnancies (without age)</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>bgp <span class="ot">&lt;-</span> <span class="fu">glm</span>(diabetes <span class="sc">~</span> . <span class="sc">-</span>age, <span class="at">data =</span> train, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="model-1" class="level3">
<h3 class="anchored" data-anchor-id="model-1">Model 1</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Summarize model including BMI, glucose, age, and pregnancies</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(all_var)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = diabetes ~ ., family = binomial(link = "logit"), 
    data = train)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.2423  -0.7382  -0.4133   0.7876   2.3714  

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -8.78253    0.86386 -10.167  &lt; 2e-16 ***
pregnancies  0.12194    0.03801   3.208  0.00134 ** 
glucose      0.03583    0.00420   8.533  &lt; 2e-16 ***
bmi          0.08150    0.01762   4.626 3.74e-06 ***
age          0.01328    0.01057   1.257  0.20877    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 679.74  on 525  degrees of freedom
Residual deviance: 507.97  on 521  degrees of freedom
AIC: 517.97

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
<p>We can see with the all variable model that pregnancies, glucose, and bmi have low p-values. That suggests those variables have a relationship with the outcome variable.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Find Odds ratios</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(all_var<span class="sc">$</span>coefficients)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> (Intercept)  pregnancies      glucose          bmi          age 
0.0001533891 1.1296866950 1.0364834768 1.0849156509 1.0133694157 </code></pre>
</div>
</div>
<p>The odds ratio for pregnancies, glucose, bmi, and age are 1.130, 1.036, 1.085, and 1.013 respectively. They are all greater than 1, suggesting each variable increases the likelihood of the outcome variable.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Classify test set</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred_prob_mod1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(all_var, <span class="at">newdata =</span> test, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred_class_mod1 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(test<span class="sc">$</span>pred_prob_mod1 <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 226
Columns: 7
$ pregnancies     &lt;dbl&gt; 2, 4, 10, 1, 5, 7, 9, 11, 7, 5, 11, 2, 1, 2, 1, 8, 7, …
$ glucose         &lt;dbl&gt; 197, 110, 139, 189, 166, 107, 119, 143, 147, 109, 138,…
$ bmi             &lt;dbl&gt; 30.5, 37.6, 27.1, 30.1, 25.8, 29.6, 29.0, 36.6, 39.4, …
$ age             &lt;dbl&gt; 53, 30, 57, 59, 51, 31, 29, 51, 43, 60, 35, 27, 29, 22…
$ diabetes        &lt;dbl&gt; 1, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, …
$ pred_prob_mod1  &lt;dbl&gt; 0.84687410, 0.29107806, 0.59471088, 0.79392775, 0.6354…
$ pred_class_mod1 &lt;dbl&gt; 1, 0, 1, 1, 1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 1, 1, 1, …</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create confusion matrix</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>cm_mod1 <span class="ot">&lt;-</span> <span class="fu">table</span>(test<span class="sc">$</span>pred_class_mod1, test<span class="sc">$</span>diabetes)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cm_mod1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   
      0   1
  0 131  30
  1  14  51</code></pre>
</div>
</div>
<p>The predicted outcomes are in rows and true outcomes in columns.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculate precision, recall and F-score</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>tp1 <span class="ot">&lt;-</span> cm_mod1[<span class="dv">2</span>,<span class="dv">2</span>]</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>tn1 <span class="ot">&lt;-</span> cm_mod1[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>fp1 <span class="ot">&lt;-</span> cm_mod1[<span class="dv">2</span>,<span class="dv">1</span>] </span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>fn1 <span class="ot">&lt;-</span> cm_mod1[<span class="dv">1</span>,<span class="dv">2</span>] </span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>precision1 <span class="ot">&lt;-</span> tp1 <span class="sc">/</span> (tp1 <span class="sc">+</span> fp1)</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>recall1 <span class="ot">&lt;-</span> tp1 <span class="sc">/</span> (tp1 <span class="sc">+</span> fn1)</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>f1_score1 <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> ((precision1 <span class="sc">*</span> recall1 ) <span class="sc">/</span> (precision1 <span class="sc">+</span> recall1)) </span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>accuracy1 <span class="ot">&lt;-</span> (tp1 <span class="sc">+</span> tn1) <span class="sc">/</span> (tp1 <span class="sc">+</span> tn1 <span class="sc">+</span> fp1 <span class="sc">+</span> fn1)</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'Precision of Model 1:'</span>, precision1,<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Precision of Model 1: 0.7846154 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'Recall of Model 1:'</span>, recall1,<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Recall of Model 1: 0.6296296 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'F1 of Model 1:'</span>, f1_score1,<span class="st">'</span><span class="sc">\n</span><span class="st">'</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>F1 of Model 1: 0.6986301 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'Accuracy of Model 1:'</span>, accuracy1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Accuracy of Model 1: 0.8053097</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Build ROC curve</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">roc</span>(test<span class="sc">$</span>diabetes <span class="sc">~</span> test<span class="sc">$</span>pred_prob_mod1), <span class="at">print.auc =</span> <span class="cn">TRUE</span>, <span class="at">legacy.axes=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in roc(test$diabetes ~ test$pred_prob_mod1): could not find function "roc"</code></pre>
</div>
</div>
<p>The ROC curve a decent size with a area under the curve (AUC) of 0.842. Lets compare this model to our others as we go.</p>
</section>
<section id="model-2" class="level3">
<h3 class="anchored" data-anchor-id="model-2">Model 2</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Summarize BMI, glucose, and age model</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = diabetes ~ . - pregnancies, family = binomial(link = "logit"), 
    data = train)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.4041  -0.7545  -0.4352   0.7993   2.3643  

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -8.744037   0.852715 -10.254  &lt; 2e-16 ***
glucose      0.035131   0.004137   8.492  &lt; 2e-16 ***
bmi          0.079445   0.017191   4.621 3.82e-06 ***
age          0.031119   0.008956   3.474 0.000512 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 679.74  on 525  degrees of freedom
Residual deviance: 518.60  on 522  degrees of freedom
AIC: 526.6

Number of Fisher Scoring iterations: 4</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(train, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span>bmi, <span class="at">color=</span>glucose)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">facet_grid</span>(<span class="sc">~</span>diabetes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="StephRoberts_finalpart2_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The model looking at BMI, age, and glucose as explanatory variables for diabetes has an AIC of 526.6, which is a worse fit than the all variables model.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Find Odds ratios</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(bga<span class="sc">$</span>coefficients)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> (Intercept)      glucose          bmi          age 
0.0001594091 1.0357553417 1.0826854994 1.0316077434 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Classify test set</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred_prob_mod2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(bga, <span class="at">newdata =</span> test, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred_class_mod2 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(test<span class="sc">$</span>pred_prob_mod2 <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create confusion matrix</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>cm_mod2 <span class="ot">&lt;-</span> <span class="fu">table</span>(test<span class="sc">$</span>pred_class_mod2, test<span class="sc">$</span>diabetes)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cm_mod2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   
      0   1
  0 131  28
  1  14  53</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculate precision, recall and F-score</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>tp2 <span class="ot">&lt;-</span> cm_mod2[<span class="dv">2</span>,<span class="dv">2</span>]</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>tn2 <span class="ot">&lt;-</span> cm_mod2[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>fp2 <span class="ot">&lt;-</span> cm_mod2[<span class="dv">2</span>,<span class="dv">1</span>] </span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>fn2 <span class="ot">&lt;-</span> cm_mod2[<span class="dv">1</span>,<span class="dv">2</span>] </span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>precision2 <span class="ot">&lt;-</span> tp2 <span class="sc">/</span> (tp2 <span class="sc">+</span> fp2)</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>recall2 <span class="ot">&lt;-</span> tp2 <span class="sc">/</span> (tp2 <span class="sc">+</span> fn2)</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>f1_score2 <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> ((precision2 <span class="sc">*</span> recall2 ) <span class="sc">/</span> (precision2 <span class="sc">+</span> recall2)) </span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>accuracy2 <span class="ot">&lt;-</span> (tp2 <span class="sc">+</span> tn2) <span class="sc">/</span> (tp2 <span class="sc">+</span> tn2 <span class="sc">+</span> fp2 <span class="sc">+</span> fn2)</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'Precision of Model 2:'</span>, precision2,<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Precision of Model 2: 0.7910448 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'Recall of Model 2:'</span>, recall2,<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Recall of Model 2: 0.654321 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'F1 of Model 2:'</span>, f1_score2,<span class="st">'</span><span class="sc">\n</span><span class="st">'</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>F1 of Model 2: 0.7162162 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'Accuracy of Model 2:'</span>, accuracy2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Accuracy of Model 2: 0.8141593</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Build ROC curve</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">roc</span>(test<span class="sc">$</span>diabetes <span class="sc">~</span> test<span class="sc">$</span>pred_prob_mod2), <span class="at">print.auc =</span> <span class="cn">TRUE</span>, <span class="at">legacy.axes=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in roc(test$diabetes ~ test$pred_prob_mod2): could not find function "roc"</code></pre>
</div>
</div>
<p>Model 2 presents an AUC of 0.846, slightly bigger than model 1. It does become starkly less smooth around 0.6 on the y axis, sensitivity. Let’s see if the any other models present this way.</p>
</section>
<section id="model-3" class="level3">
<h3 class="anchored" data-anchor-id="model-3">Model 3</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Summarize BMI and glucose model</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = diabetes ~ . - age - pregnancies, family = binomial(link = "logit"), 
    data = train)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.1839  -0.7780  -0.4709   0.7866   2.2925  

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -7.66078    0.76033 -10.076  &lt; 2e-16 ***
glucose      0.03728    0.00412   9.049  &lt; 2e-16 ***
bmi          0.07097    0.01677   4.231 2.32e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 679.74  on 525  degrees of freedom
Residual deviance: 530.80  on 523  degrees of freedom
AIC: 536.8

Number of Fisher Scoring iterations: 4</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(train, <span class="fu">aes</span>(<span class="at">x=</span>glucose, <span class="at">y=</span>bmi, <span class="at">color=</span>diabetes)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">facet_grid</span>(<span class="sc">~</span>diabetes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="StephRoberts_finalpart2_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This BMI and glucose only model has a worse (higher) AIC, with 536.8, than the 2 previous models. So far, the all variable model appears the best fit.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Find Odds ratios</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(bg<span class="sc">$</span>coefficients)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> (Intercept)      glucose          bmi 
0.0004709409 1.0379849799 1.0735473744 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Classify test set</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred_prob_mod3 <span class="ot">&lt;-</span> <span class="fu">predict</span>(bg, <span class="at">newdata =</span> test, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred_class_mod3 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(test<span class="sc">$</span>pred_prob_mod3 <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create confusion matrix</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>cm_mod3 <span class="ot">&lt;-</span> <span class="fu">table</span>(test<span class="sc">$</span>pred_class_mod3, test<span class="sc">$</span>diabetes)</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cm_mod3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   
      0   1
  0 135  31
  1  10  50</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculate precision, recall and F-score</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>tp3 <span class="ot">&lt;-</span> cm_mod3[<span class="dv">2</span>,<span class="dv">2</span>]</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>tn3 <span class="ot">&lt;-</span> cm_mod3[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>fp3 <span class="ot">&lt;-</span> cm_mod3[<span class="dv">2</span>,<span class="dv">1</span>] </span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>fn3 <span class="ot">&lt;-</span> cm_mod3[<span class="dv">1</span>,<span class="dv">2</span>] </span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>precision3 <span class="ot">&lt;-</span> tp3 <span class="sc">/</span> (tp3 <span class="sc">+</span> fp3)</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>recall3 <span class="ot">&lt;-</span> tp3 <span class="sc">/</span> (tp3 <span class="sc">+</span> fn3)</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>f1_score3 <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> ((precision3 <span class="sc">*</span> recall3 ) <span class="sc">/</span> (precision3 <span class="sc">+</span> recall3)) </span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>accuracy3 <span class="ot">&lt;-</span> (tp3 <span class="sc">+</span> tn3) <span class="sc">/</span> (tp3 <span class="sc">+</span> tn3 <span class="sc">+</span> fp3 <span class="sc">+</span> fn3)</span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'Precision of Model 3:'</span>, precision3,<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Precision of Model 3: 0.8333333 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'Recall of Model 3:'</span>, recall3,<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Recall of Model 3: 0.617284 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'F1 of Model 3:'</span>, f1_score3,<span class="st">'</span><span class="sc">\n</span><span class="st">'</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>F1 of Model 3: 0.7092199 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'Accuracy of Model 3:'</span>, accuracy3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Accuracy of Model 3: 0.8185841</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Build ROC curve</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">roc</span>(test<span class="sc">$</span>diabetes <span class="sc">~</span> test<span class="sc">$</span>pred_prob_mod3), <span class="at">print.auc =</span> <span class="cn">TRUE</span>, <span class="at">legacy.axes=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in roc(test$diabetes ~ test$pred_prob_mod3): could not find function "roc"</code></pre>
</div>
</div>
<p>Model 3 has a lower AUC (0.840) than model 1 (0.842) and model 2 (0.846).</p>
</section>
<section id="model-4" class="level3">
<h3 class="anchored" data-anchor-id="model-4">Model 4</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Summarize model including interaction between age and pregnancies </span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="co">#This was chosen to see if the impact of age on diabetes is different depending on the number of pregnancies</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ia)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = diabetes ~ glucose + bmi + age * pregnancies, family = binomial(link = "logit"), 
    data = train)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.4728  -0.6818  -0.4072   0.7648   2.3441  

Coefficients:
                  Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)     -10.231410   1.028027  -9.952  &lt; 2e-16 ***
glucose           0.035779   0.004238   8.442  &lt; 2e-16 ***
bmi               0.084510   0.017867   4.730 2.25e-06 ***
age               0.053813   0.016978   3.170  0.00153 ** 
pregnancies       0.505863   0.134568   3.759  0.00017 ***
age:pregnancies  -0.009962   0.003337  -2.985  0.00283 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 679.74  on 525  degrees of freedom
Residual deviance: 498.41  on 520  degrees of freedom
AIC: 510.41

Number of Fisher Scoring iterations: 5</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(train, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span>bmi, <span class="at">color=</span>pregnancies)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">facet_grid</span>(<span class="sc">~</span>diabetes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="StephRoberts_finalpart2_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>With an AIC of 510.41, this model appears to be the best fit model of those we have compared. This indicated there is an interaction between age and pregnancies that has a relationship with the outcome variable.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Find Odds ratios</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(ia<span class="sc">$</span>coefficients)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    (Intercept)         glucose             bmi             age     pregnancies 
   3.602094e-05    1.036427e+00    1.088183e+00    1.055287e+00    1.658416e+00 
age:pregnancies 
   9.900878e-01 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Classify test set</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred_prob_mod4 <span class="ot">&lt;-</span> <span class="fu">predict</span>(ia, <span class="at">newdata =</span> test, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred_class_mod4 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(test<span class="sc">$</span>pred_prob_mod4 <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create confusion matrix</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>cm_mod4 <span class="ot">&lt;-</span> <span class="fu">table</span>(test<span class="sc">$</span>pred_class_mod4, test<span class="sc">$</span>diabetes)</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cm_mod4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   
      0   1
  0 129  32
  1  16  49</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculate precision, recall and F-score</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>tp4 <span class="ot">&lt;-</span> cm_mod4[<span class="dv">2</span>,<span class="dv">2</span>]</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>tn4 <span class="ot">&lt;-</span> cm_mod4[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>fp4 <span class="ot">&lt;-</span> cm_mod4[<span class="dv">2</span>,<span class="dv">1</span>] </span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>fn4 <span class="ot">&lt;-</span> cm_mod4[<span class="dv">1</span>,<span class="dv">2</span>] </span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>precision4 <span class="ot">&lt;-</span> tp4 <span class="sc">/</span> (tp4 <span class="sc">+</span> fp4)</span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>recall4 <span class="ot">&lt;-</span> tp4 <span class="sc">/</span> (tp4 <span class="sc">+</span> fn4)</span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a>f1_score4 <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> ((precision4 <span class="sc">*</span> recall4 ) <span class="sc">/</span> (precision4 <span class="sc">+</span> recall4)) </span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a>accuracy4 <span class="ot">&lt;-</span> (tp4 <span class="sc">+</span> tn4) <span class="sc">/</span> (tp4 <span class="sc">+</span> tn4 <span class="sc">+</span> fp4 <span class="sc">+</span> fn4)</span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'Precision of Model 4:'</span>, precision4,<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Precision of Model 4: 0.7538462 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'Recall of Model 4:'</span>, recall4,<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Recall of Model 4: 0.6049383 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'F1 of Model 4:'</span>, f1_score4,<span class="st">'</span><span class="sc">\n</span><span class="st">'</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>F1 of Model 4: 0.6712329 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'Accuracy of Model 4:'</span>, accuracy4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Accuracy of Model 4: 0.7876106</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Build ROC curve</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">roc</span>(test<span class="sc">$</span>diabetes <span class="sc">~</span> test<span class="sc">$</span>pred_prob_mod4), <span class="at">print.auc =</span> <span class="cn">TRUE</span>, <span class="at">legacy.axes=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in roc(test$diabetes ~ test$pred_prob_mod4): could not find function "roc"</code></pre>
</div>
</div>
<p>Model 4 has similar AUC to 1 and 3.</p>
</section>
<section id="model-5" class="level3">
<h3 class="anchored" data-anchor-id="model-5">Model 5</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Summarize model including without age</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bgp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = diabetes ~ . - age, family = binomial(link = "logit"), 
    data = train)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.2180  -0.7390  -0.4176   0.7806   2.3503  

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -8.454908   0.814921 -10.375  &lt; 2e-16 ***
pregnancies  0.147046   0.032598   4.511 6.46e-06 ***
glucose      0.036658   0.004169   8.794  &lt; 2e-16 ***
bmi          0.079282   0.017533   4.522 6.13e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 679.74  on 525  degrees of freedom
Residual deviance: 509.54  on 522  degrees of freedom
AIC: 517.54

Number of Fisher Scoring iterations: 4</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(train, <span class="fu">aes</span>(<span class="at">x=</span>pregnancies, <span class="at">y=</span>bmi, <span class="at">color=</span>glucose)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">facet_grid</span>(<span class="sc">~</span>diabetes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="StephRoberts_finalpart2_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Removing age entirely increased the AIC of this model. So, the interaction model seems to be the best fit. That is, model 4 which includes BMI and glucose and controls for an interaction between age and pregnancy has the best fit of all models tested.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Find Odds ratios</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(bgp<span class="sc">$</span>coefficients)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> (Intercept)  pregnancies      glucose          bmi 
0.0002128532 1.1584076914 1.0373385122 1.0825095827 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Classify test set</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred_prob_mod5 <span class="ot">&lt;-</span> <span class="fu">predict</span>(bgp, <span class="at">newdata =</span> test, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred_class_mod5 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(test<span class="sc">$</span>pred_prob_mod5 <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create confusion matrix</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>cm_mod5 <span class="ot">&lt;-</span> <span class="fu">table</span>(test<span class="sc">$</span>pred_class_mod5, test<span class="sc">$</span>diabetes)</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cm_mod5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   
      0   1
  0 131  30
  1  14  51</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculate precision, recall and F-score</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>tp5 <span class="ot">&lt;-</span> cm_mod5[<span class="dv">2</span>,<span class="dv">2</span>]</span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>tn5 <span class="ot">&lt;-</span> cm_mod5[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>fp5 <span class="ot">&lt;-</span> cm_mod5[<span class="dv">2</span>,<span class="dv">1</span>] </span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>fn5 <span class="ot">&lt;-</span> cm_mod5[<span class="dv">1</span>,<span class="dv">2</span>] </span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>precision5 <span class="ot">&lt;-</span> tp5 <span class="sc">/</span> (tp5 <span class="sc">+</span> fp5)</span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>recall5 <span class="ot">&lt;-</span> tp5 <span class="sc">/</span> (tp5 <span class="sc">+</span> fn5)</span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a>f1_score5 <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> ((precision5 <span class="sc">*</span> recall5 ) <span class="sc">/</span> (precision5 <span class="sc">+</span> recall5)) </span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a>accuracy5 <span class="ot">&lt;-</span> (tp5 <span class="sc">+</span> tn5) <span class="sc">/</span> (tp5 <span class="sc">+</span> tn5 <span class="sc">+</span> fp5 <span class="sc">+</span> fn5)</span>
<span id="cb138-11"><a href="#cb138-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-12"><a href="#cb138-12" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'Precision of Model 5:'</span>, precision5,<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Precision of Model 5: 0.7846154 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'Recall of Model5:'</span>, recall5,<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Recall of Model5: 0.6296296 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'F1 of Model 5:'</span>, f1_score5,<span class="st">'</span><span class="sc">\n</span><span class="st">'</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>F1 of Model 5: 0.6986301 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'Accuracy of Model 5:'</span>, accuracy5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Accuracy of Model 5: 0.8053097</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Build ROC curve</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">roc</span>(test<span class="sc">$</span>diabetes <span class="sc">~</span> test<span class="sc">$</span>pred_prob_mod5), <span class="at">print.auc =</span> <span class="cn">TRUE</span>, <span class="at">legacy.axes=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in roc(test$diabetes ~ test$pred_prob_mod5): could not find function "roc"</code></pre>
</div>
</div>
</section>
<section id="choosing-a-model" class="level3">
<h3 class="anchored" data-anchor-id="choosing-a-model">Choosing a model:</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create table to compare models</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>auc1<span class="ot">&lt;-</span>(<span class="fl">0.842</span>)</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>auc2<span class="ot">&lt;-</span>(<span class="fl">0.846</span>)</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>auc3<span class="ot">&lt;-</span>(<span class="fl">0.840</span>)</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>auc4<span class="ot">&lt;-</span>(<span class="fl">0.841</span>)</span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>auc5<span class="ot">&lt;-</span>(<span class="fl">0.838</span>)</span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>comp_mods <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(accuracy1, accuracy2, accuracy3, accuracy4, accuracy5, f1_score1, f1_score2, f1_score3, f1_score4, f1_score5, recall1, recall2, recall3, recall4, recall5, precision1, precision2, precision3, precision4, precision5, auc1, auc2, auc3, auc4, auc5), <span class="at">ncol=</span><span class="dv">5</span>, <span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(comp_mods) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Model 1'</span>,<span class="st">'Model 2'</span>,<span class="st">'Model 3'</span>, <span class="st">'Model4'</span>, <span class="st">'Model5'</span>)</span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(comp_mods) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Accuracy'</span>,<span class="st">'F1 Score'</span>,<span class="st">'Recall'</span>, <span class="st">'Prescision'</span>, <span class="st">'AUC'</span>)</span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a>comp_mods <span class="ot">&lt;-</span> <span class="fu">as.table</span>(comp_mods)</span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a>comp_mods</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>             Model 1   Model 2   Model 3    Model4    Model5
Accuracy   0.8053097 0.8141593 0.8185841 0.7876106 0.8053097
F1 Score   0.6986301 0.7162162 0.7092199 0.6712329 0.6986301
Recall     0.6296296 0.6543210 0.6172840 0.6049383 0.6296296
Prescision 0.7846154 0.7910448 0.8333333 0.7538462 0.7846154
AUC        0.8420000 0.8460000 0.8400000 0.8410000 0.8380000</code></pre>
</div>
</div>
<p>Model 3 has the highest accuracy, with 2 close behind it. The F1 score, which is the harmonic mean, takes both recall and precision into account. Model 2 has the highest F1 score with Model 3 close behind. Model 2 also has the highest AUC. Model 2, which used BMI, glucose, and age as predictor values for diabetes, looks like the best fit.</p>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="DACSS/603_Fall_2022" data-repo-id="R_kgDOH568kA" data-category="Announcements" data-category-id="" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb150" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Final Project: Diabetes Prediction - Part 2"</span></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Steph Roberts"</span></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a><span class="an">desription:</span><span class="co"> "Final Project Draft 2"</span></span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "10/9/2022"</span></span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb150-9"><a href="#cb150-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb150-10"><a href="#cb150-10" aria-hidden="true" tabindex="-1"></a><span class="co">    code-copy: true</span></span>
<span id="cb150-11"><a href="#cb150-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb150-12"><a href="#cb150-12" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb150-13"><a href="#cb150-13" aria-hidden="true" tabindex="-1"></a><span class="co">  - finalproject</span></span>
<span id="cb150-14"><a href="#cb150-14" aria-hidden="true" tabindex="-1"></a><span class="co">  - Steph Roberts</span></span>
<span id="cb150-15"><a href="#cb150-15" aria-hidden="true" tabindex="-1"></a><span class="co">  - dataset</span></span>
<span id="cb150-16"><a href="#cb150-16" aria-hidden="true" tabindex="-1"></a><span class="co">  - ggplot2</span></span>
<span id="cb150-17"><a href="#cb150-17" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb150-18"><a href="#cb150-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-21"><a href="#cb150-21" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-22"><a href="#cb150-22" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb150-23"><a href="#cb150-23" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb150-24"><a href="#cb150-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-25"><a href="#cb150-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb150-26"><a href="#cb150-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb150-27"><a href="#cb150-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb150-28"><a href="#cb150-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb150-29"><a href="#cb150-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Hmisc)</span>
<span id="cb150-30"><a href="#cb150-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb150-31"><a href="#cb150-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-32"><a href="#cb150-32" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>)</span>
<span id="cb150-33"><a href="#cb150-33" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-34"><a href="#cb150-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-35"><a href="#cb150-35" aria-hidden="true" tabindex="-1"></a><span class="fu">### Diabetes risk factors</span></span>
<span id="cb150-36"><a href="#cb150-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-37"><a href="#cb150-37" aria-hidden="true" tabindex="-1"></a>According to the World Health Organization (WHO), an estimated 537 million people worldwide are living with diabetes. It is a leading cause of health complications and even death. The WHO states close to 1.5 million people died due to diabetes and its complication in 2019 alone. It is a growing problem that requires dedicated research to aim at the slowdown and prevention of future cases. </span>
<span id="cb150-38"><a href="#cb150-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-39"><a href="#cb150-39" aria-hidden="true" tabindex="-1"></a><span class="fu">## Research Question</span></span>
<span id="cb150-40"><a href="#cb150-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-41"><a href="#cb150-41" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>What risk factors are most predictive of diabetes? </span>
<span id="cb150-42"><a href="#cb150-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-43"><a href="#cb150-43" aria-hidden="true" tabindex="-1"></a>Research on Diabetes is ongoing and in-depth within the medical field. The prevalence and incidence of diabetes mellitus type 2 (DQ2) have increased consistently for decades, giving way to an increase in mortality related to diabetes. Commonly in the medical field, many risk factors are used to measure a patient’s risk of developing DM2, such as obesity, family history, hypertension and changes in fasting blood sugar levels. </span>
<span id="cb150-44"><a href="#cb150-44" aria-hidden="true" tabindex="-1"></a>Moreno et al. (2018) studied risk parameters for diabetes and concluded "risk of being diabetic rises in patients whose father has suffered an acute myocardial infarction, in those whose mother or father is diabetic and in patients with a high waist perimeter." </span>
<span id="cb150-45"><a href="#cb150-45" aria-hidden="true" tabindex="-1"></a>Their focus on family history leaves room for studies more focused on individual medical factors, such as blood pressure, BMI, number of pregnancies, etc. That is the aim of this project.</span>
<span id="cb150-46"><a href="#cb150-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-47"><a href="#cb150-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-48"><a href="#cb150-48" aria-hidden="true" tabindex="-1"></a>M. L. M. V. J. A. (2018, June 11). Predictive risk model for the diagnosis of diabetes mellitus type 2 in a follow-up study 15 Years on: Prodi2 study. European journal of public health. Retrieved October 9, 2022, from https://pubmed.ncbi.nlm.nih.gov/29897477/ </span>
<span id="cb150-49"><a href="#cb150-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-50"><a href="#cb150-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-51"><a href="#cb150-51" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Can the use of regression analysis help predict risk of diabetes based on several medical variables?</span>
<span id="cb150-52"><a href="#cb150-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-53"><a href="#cb150-53" aria-hidden="true" tabindex="-1"></a>Other research, such as a Edlitz &amp; Segal (2022) study titled Prediction of type 2 diabetes mellitus onset using logistic regression-based scorecards, does focus on using individual medical factors to predict risk of diabetes through regression. This project aims to conduct similar analysis on different data. </span>
<span id="cb150-54"><a href="#cb150-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-55"><a href="#cb150-55" aria-hidden="true" tabindex="-1"></a>E. Y. S. E. (2022, June 22). Prediction of type 2 diabetes mellitus onset using logistic regression-based scorecards. eLife. Retrieved October 9, 2022, from https://pubmed.ncbi.nlm.nih.gov/35731045/ </span>
<span id="cb150-56"><a href="#cb150-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-57"><a href="#cb150-57" aria-hidden="true" tabindex="-1"></a><span class="fu">## Hypothesis</span></span>
<span id="cb150-58"><a href="#cb150-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-59"><a href="#cb150-59" aria-hidden="true" tabindex="-1"></a>Body mass index (BMI), glucose, and age are positive predictors of diabetes mellitus type 2.  </span>
<span id="cb150-60"><a href="#cb150-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-61"><a href="#cb150-61" aria-hidden="true" tabindex="-1"></a>This hypothesis has been tested in the above mentioned studies. The contribution from this project will be the additional support for or against the hypotheses from the analysis of different data. </span>
<span id="cb150-62"><a href="#cb150-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-63"><a href="#cb150-63" aria-hidden="true" tabindex="-1"></a><span class="fu">## Descriptive Statistics</span></span>
<span id="cb150-64"><a href="#cb150-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-65"><a href="#cb150-65" aria-hidden="true" tabindex="-1"></a>The data was collected by the “National Institute of Diabetes and Digestive and Kidney Diseases” as part of the Pima Indians Diabetes Database (PIDD). A total of 768 cases are available in PIDD. However, 5 patients had a glucose of 0 and 11 patients had a body mass index of 0. After cleaning the data by removing the cases with numbers that are incompatible with life in categories important to the current research, 752 cases remained. All patients belong to the Pima Indian heritage (subgroup of Native Americans), and are females aged 21 years and above.</span>
<span id="cb150-66"><a href="#cb150-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-67"><a href="#cb150-67" aria-hidden="true" tabindex="-1"></a>The datasets consists of 9 medical predictor (independent) variables and one target (dependent) variable, outcome.  </span>
<span id="cb150-68"><a href="#cb150-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-69"><a href="#cb150-69" aria-hidden="true" tabindex="-1"></a>**Pregnancies:** Number of times a woman has been pregnant  </span>
<span id="cb150-70"><a href="#cb150-70" aria-hidden="true" tabindex="-1"></a>**Glucose:** Plasma Glucose concentration of 2 hours in an oral glucose tolerance test  </span>
<span id="cb150-71"><a href="#cb150-71" aria-hidden="true" tabindex="-1"></a>**BloodPressure:** Diastolic Blood Pressure (mm hg)  </span>
<span id="cb150-72"><a href="#cb150-72" aria-hidden="true" tabindex="-1"></a>**SkinThickness:** Triceps skin fold thickness(mm)  </span>
<span id="cb150-73"><a href="#cb150-73" aria-hidden="true" tabindex="-1"></a>**Insulin:** 2 hour serum insulin(mu U/ml)  </span>
<span id="cb150-74"><a href="#cb150-74" aria-hidden="true" tabindex="-1"></a>**BMI:** Body Mass Index ((weight in kg/height in m)^2)  </span>
<span id="cb150-75"><a href="#cb150-75" aria-hidden="true" tabindex="-1"></a>**Age:** Age(years)  </span>
<span id="cb150-76"><a href="#cb150-76" aria-hidden="true" tabindex="-1"></a>**DiabetesPedigreeFunction:** scores likelihood of diabetes based on family history  </span>
<span id="cb150-77"><a href="#cb150-77" aria-hidden="true" tabindex="-1"></a>**Outcome:** 0 (doesn't have diabetes) or 1 (has diabetes)</span>
<span id="cb150-78"><a href="#cb150-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-79"><a href="#cb150-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-82"><a href="#cb150-82" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-83"><a href="#cb150-83" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"_data/diabetes2.csv"</span>)</span>
<span id="cb150-84"><a href="#cb150-84" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(df)</span>
<span id="cb150-85"><a href="#cb150-85" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df)</span>
<span id="cb150-86"><a href="#cb150-86" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span>
<span id="cb150-87"><a href="#cb150-87" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-90"><a href="#cb150-90" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-91"><a href="#cb150-91" aria-hidden="true" tabindex="-1"></a><span class="co">#check for null entries</span></span>
<span id="cb150-92"><a href="#cb150-92" aria-hidden="true" tabindex="-1"></a><span class="fu">is.null</span>(df)</span>
<span id="cb150-93"><a href="#cb150-93" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-96"><a href="#cb150-96" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-97"><a href="#cb150-97" aria-hidden="true" tabindex="-1"></a><span class="co">#Check number of 0s in each column</span></span>
<span id="cb150-98"><a href="#cb150-98" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(df<span class="sc">==</span><span class="dv">0</span>)</span>
<span id="cb150-99"><a href="#cb150-99" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-100"><a href="#cb150-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-101"><a href="#cb150-101" aria-hidden="true" tabindex="-1"></a>Glucose, blood pressure, skin thickness, insulin, BMI and Age are not variables that should logically have 0s. Those values, if true, are likely incompatible with life. To reduce the amount of data we exclude, we will only remove observations that have 0s for our explanatory variables. We will remove those cases from analysis.</span>
<span id="cb150-102"><a href="#cb150-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-105"><a href="#cb150-105" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-106"><a href="#cb150-106" aria-hidden="true" tabindex="-1"></a><span class="co">#Remove rows with 0 in respective columns</span></span>
<span id="cb150-107"><a href="#cb150-107" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df[<span class="fu">apply</span>(df[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">6</span>)],<span class="dv">1</span>,<span class="cf">function</span>(z) <span class="sc">!</span><span class="fu">any</span>(z<span class="sc">==</span><span class="dv">0</span>)),] </span>
<span id="cb150-108"><a href="#cb150-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-109"><a href="#cb150-109" aria-hidden="true" tabindex="-1"></a><span class="co">#Verify 0s are gone in selected rows</span></span>
<span id="cb150-110"><a href="#cb150-110" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(df<span class="sc">==</span><span class="dv">0</span>)</span>
<span id="cb150-111"><a href="#cb150-111" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-112"><a href="#cb150-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-115"><a href="#cb150-115" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-116"><a href="#cb150-116" aria-hidden="true" tabindex="-1"></a><span class="co">#Check cleaned data frame</span></span>
<span id="cb150-117"><a href="#cb150-117" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(df)</span>
<span id="cb150-118"><a href="#cb150-118" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-119"><a href="#cb150-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-122"><a href="#cb150-122" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-123"><a href="#cb150-123" aria-hidden="true" tabindex="-1"></a><span class="co">#Summarize df</span></span>
<span id="cb150-124"><a href="#cb150-124" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df)</span>
<span id="cb150-125"><a href="#cb150-125" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-126"><a href="#cb150-126" aria-hidden="true" tabindex="-1"></a>At a glance, this summary is more fitting after having cleaned our data. An average of 3 pregnancies, considering our 21+ female population, makes sense. A mean glucose of 122, blood pressure of 70, a BMI of 33, and age of 33 are reasonably accurate for our population. </span>
<span id="cb150-127"><a href="#cb150-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-130"><a href="#cb150-130" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-131"><a href="#cb150-131" aria-hidden="true" tabindex="-1"></a><span class="co">#Rename columns</span></span>
<span id="cb150-132"><a href="#cb150-132" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"pregnancies"</span>, <span class="st">"glucose"</span>, <span class="st">"bp"</span>, <span class="st">"skin_thickness"</span>, <span class="st">"insulin"</span>, <span class="st">"bmi"</span>, <span class="st">"dpf"</span>, <span class="st">"age"</span>, <span class="st">"diabetes"</span>)</span>
<span id="cb150-133"><a href="#cb150-133" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(df)</span>
<span id="cb150-134"><a href="#cb150-134" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-135"><a href="#cb150-135" aria-hidden="true" tabindex="-1"></a>We have 752 observations and 9 variables with which to work. The data is clean and ready for analysis. </span>
<span id="cb150-136"><a href="#cb150-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-137"><a href="#cb150-137" aria-hidden="true" tabindex="-1"></a>Let's get familiar with the data set by observing the histograms for each variable.</span>
<span id="cb150-138"><a href="#cb150-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-141"><a href="#cb150-141" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-142"><a href="#cb150-142" aria-hidden="true" tabindex="-1"></a><span class="co">#Scatterplot matrix</span></span>
<span id="cb150-143"><a href="#cb150-143" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(df)</span>
<span id="cb150-144"><a href="#cb150-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-145"><a href="#cb150-145" aria-hidden="true" tabindex="-1"></a><span class="co">#Histograms of each variable</span></span>
<span id="cb150-146"><a href="#cb150-146" aria-hidden="true" tabindex="-1"></a><span class="fu">hist.data.frame</span>(df)</span>
<span id="cb150-147"><a href="#cb150-147" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-148"><a href="#cb150-148" aria-hidden="true" tabindex="-1"></a>The scatterplot matix shows that our variables generally lack linear relationships. Logistics regression may be best for analyzing this type of data. </span>
<span id="cb150-149"><a href="#cb150-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-150"><a href="#cb150-150" aria-hidden="true" tabindex="-1"></a>The histograms show us the distribution of all our variables. Pregnancies is right skewed with more women having a smaller number of pregnancies and a small number having over 10. Glucose appears to follow a close-to-normal distribution with the mean just over 100. BMI follows a similar pattern with a central value of just over 30. Age is right skewed with the majority of the sample appearing to be in their 20s and slower tapering off to ages in their 50s. This is a good place to start. The only variable we cannot view in a histogram is the outcome variable due to its binary nature as a dummy variable. </span>
<span id="cb150-151"><a href="#cb150-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-154"><a href="#cb150-154" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-155"><a href="#cb150-155" aria-hidden="true" tabindex="-1"></a>bgap <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(df[, <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">8</span>,<span class="dv">9</span>)])</span>
<span id="cb150-156"><a href="#cb150-156" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(bgap)</span>
<span id="cb150-157"><a href="#cb150-157" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-158"><a href="#cb150-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-161"><a href="#cb150-161" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-162"><a href="#cb150-162" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot outcome variable</span></span>
<span id="cb150-163"><a href="#cb150-163" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">factor</span>(diabetes))) <span class="sc">+</span></span>
<span id="cb150-164"><a href="#cb150-164" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill =</span> <span class="st">"#0073C2FF"</span>)<span class="sc">+</span></span>
<span id="cb150-165"><a href="#cb150-165" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">'No Diabetes'</span>,<span class="st">'Diabetes'</span>))<span class="sc">+</span></span>
<span id="cb150-166"><a href="#cb150-166" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Outcome"</span>)<span class="sc">+</span></span>
<span id="cb150-167"><a href="#cb150-167" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> ..count..), <span class="at">stat =</span> <span class="st">"count"</span>, <span class="at">vjust =</span> <span class="fl">1.5</span>, <span class="at">colour =</span> <span class="st">"white"</span>)</span>
<span id="cb150-168"><a href="#cb150-168" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-169"><a href="#cb150-169" aria-hidden="true" tabindex="-1"></a>About a third of our sample have diabetes, with 264 cases with diabetes and 488 without. </span>
<span id="cb150-170"><a href="#cb150-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-171"><a href="#cb150-171" aria-hidden="true" tabindex="-1"></a><span class="fu">## Hypothesis Testing</span></span>
<span id="cb150-172"><a href="#cb150-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-173"><a href="#cb150-173" aria-hidden="true" tabindex="-1"></a>To test our hypothesis we could use either linear regression or logistics regression. Considering the outcome variable is binary, logistics regression is likely going to be best. First, though, let's try to plot a linear regression as a type of diagnostics test. </span>
<span id="cb150-174"><a href="#cb150-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-175"><a href="#cb150-175" aria-hidden="true" tabindex="-1"></a><span class="fu">### Diagnostics</span></span>
<span id="cb150-176"><a href="#cb150-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-179"><a href="#cb150-179" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-180"><a href="#cb150-180" aria-hidden="true" tabindex="-1"></a>dlm <span class="ot">&lt;-</span> <span class="fu">lm</span>(diabetes <span class="sc">~</span> bmi <span class="sc">+</span> glucose <span class="sc">+</span> age, <span class="at">data =</span> df)</span>
<span id="cb150-181"><a href="#cb150-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-182"><a href="#cb150-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-183"><a href="#cb150-183" aria-hidden="true" tabindex="-1"></a><span class="co">#Diagnostic plot of model</span></span>
<span id="cb150-184"><a href="#cb150-184" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dlm)</span>
<span id="cb150-185"><a href="#cb150-185" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-186"><a href="#cb150-186" aria-hidden="true" tabindex="-1"></a>**Residuals vs Fitted**: The residuals have 2 distinct patterns of behavior. This is likely due to our model representing two distinct outcomes. It therefore breaks normality. </span>
<span id="cb150-187"><a href="#cb150-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-188"><a href="#cb150-188" aria-hidden="true" tabindex="-1"></a>**Normal Q-Q**: The Q-Q plot, which indicates level of asymmetry, tells us our data is not a normal distribution. It appears to have a right tail (see the points drifting from the line at the top). It  also has values away from the line on the bottom left, away from the intercept. This suggests our model also includes a left tail. This distribution seems to have "fat tails."</span>
<span id="cb150-189"><a href="#cb150-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-190"><a href="#cb150-190" aria-hidden="true" tabindex="-1"></a>**Scale-Location**: This plots the fitted values of the model along the x-axis and the square root of the standardized residuals along the y-axis. There is a clear X pattern among residuals. This suggests our model has heteroscedasticity, which is not ideal. </span>
<span id="cb150-191"><a href="#cb150-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-192"><a href="#cb150-192" aria-hidden="true" tabindex="-1"></a>**Residuals vs Leverage**: The points on this graph all fall within Cook's distance, indicating there are not any influential points in our regression model. </span>
<span id="cb150-193"><a href="#cb150-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-194"><a href="#cb150-194" aria-hidden="true" tabindex="-1"></a>**Conclusion**: A linear regression does not appear to be the best regression analysis to use for this data. Instead, we will work with logistics regression to test our hypothesis, then train and test the data. </span>
<span id="cb150-195"><a href="#cb150-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-196"><a href="#cb150-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-199"><a href="#cb150-199" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-200"><a href="#cb150-200" aria-hidden="true" tabindex="-1"></a><span class="co">#Create training and test data</span></span>
<span id="cb150-201"><a href="#cb150-201" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb150-202"><a href="#cb150-202" aria-hidden="true" tabindex="-1"></a>bgap <span class="sc">%&gt;%</span> </span>
<span id="cb150-203"><a href="#cb150-203" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb150-204"><a href="#cb150-204" aria-hidden="true" tabindex="-1"></a>  <span class="fu">multiply_by</span>(<span class="fl">0.7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb150-205"><a href="#cb150-205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>() <span class="ot">-&gt;</span> training_set_size</span>
<span id="cb150-206"><a href="#cb150-206" aria-hidden="true" tabindex="-1"></a>train_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df), training_set_size)</span>
<span id="cb150-207"><a href="#cb150-207" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> bgap[train_indices,]</span>
<span id="cb150-208"><a href="#cb150-208" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> bgap[<span class="sc">-</span>train_indices,]</span>
<span id="cb150-209"><a href="#cb150-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-210"><a href="#cb150-210" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(train)</span>
<span id="cb150-211"><a href="#cb150-211" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(test)</span>
<span id="cb150-212"><a href="#cb150-212" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(train)</span>
<span id="cb150-213"><a href="#cb150-213" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-214"><a href="#cb150-214" aria-hidden="true" tabindex="-1"></a>Our hypothesis involves the BMI, glucose, and age variables. First we can take a look at them individually. </span>
<span id="cb150-215"><a href="#cb150-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-218"><a href="#cb150-218" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-219"><a href="#cb150-219" aria-hidden="true" tabindex="-1"></a><span class="co">#Logistics regression is best for binomial outcome variables </span></span>
<span id="cb150-220"><a href="#cb150-220" aria-hidden="true" tabindex="-1"></a><span class="co">#Regression model on BMI</span></span>
<span id="cb150-221"><a href="#cb150-221" aria-hidden="true" tabindex="-1"></a>mbmi <span class="ot">&lt;-</span> <span class="fu">glm</span>(diabetes <span class="sc">~</span> bmi, <span class="at">data =</span> train, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb150-222"><a href="#cb150-222" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mbmi)</span>
<span id="cb150-223"><a href="#cb150-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-224"><a href="#cb150-224" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(mbmi<span class="sc">$</span>coefficients)</span>
<span id="cb150-225"><a href="#cb150-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-226"><a href="#cb150-226" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(train, <span class="fu">aes</span>(<span class="at">x =</span>bmi, <span class="at">y =</span> diabetes)) <span class="sc">+</span></span>
<span id="cb150-227"><a href="#cb150-227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span>.<span class="dv">5</span>, <span class="at">col=</span><span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb150-228"><a href="#cb150-228" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">'glm'</span>, <span class="at">se=</span><span class="cn">FALSE</span>, <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">family=</span>binomial))</span>
<span id="cb150-229"><a href="#cb150-229" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-230"><a href="#cb150-230" aria-hidden="true" tabindex="-1"></a>Interpretation: The exponentiation of the coefficient tells us that a 1-unit increase in BMI multiplies the odds of diabetes by 1.096. The residuals are relatively small. The coefficient estimate suggests that for every 1 unit increase of BMI, the chance of diabetes increases 0.091. The very small p-value of 5.58e-13 indicates we can reject the null hypothesis and conclude a relationship between BMI and diabetes. </span>
<span id="cb150-231"><a href="#cb150-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-234"><a href="#cb150-234" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-235"><a href="#cb150-235" aria-hidden="true" tabindex="-1"></a><span class="co">#Regression model on glucose </span></span>
<span id="cb150-236"><a href="#cb150-236" aria-hidden="true" tabindex="-1"></a>mgluc <span class="ot">&lt;-</span> <span class="fu">glm</span>(diabetes <span class="sc">~</span> glucose, <span class="at">data =</span> train, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb150-237"><a href="#cb150-237" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mgluc)</span>
<span id="cb150-238"><a href="#cb150-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-239"><a href="#cb150-239" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(mgluc<span class="sc">$</span>coefficients)</span>
<span id="cb150-240"><a href="#cb150-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-241"><a href="#cb150-241" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> train, <span class="fu">aes</span>(<span class="at">x =</span> glucose, <span class="at">y =</span> diabetes)) <span class="sc">+</span></span>
<span id="cb150-242"><a href="#cb150-242" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span>.<span class="dv">5</span>, <span class="at">col=</span><span class="st">"darkseagreen"</span>) <span class="sc">+</span></span>
<span id="cb150-243"><a href="#cb150-243" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">'glm'</span>, <span class="at">se=</span><span class="cn">FALSE</span>, <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">family=</span>binomial))</span>
<span id="cb150-244"><a href="#cb150-244" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-245"><a href="#cb150-245" aria-hidden="true" tabindex="-1"></a>Interpretation: The exponentiation of the coefficient tells us that a 1-unit increase in plasma glucose concentration multiplies the odds of diabetes by 1.040. With a very small p-value, &lt;2e-16, we can see that the plasma glucose concentrations of the 2 hour oral glucose tolerance test (GGT) are related to our outcome variable, diabetes. This makes sense as GGT is sometimes used as a diagnostic tool for diabetes. </span>
<span id="cb150-246"><a href="#cb150-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-249"><a href="#cb150-249" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-250"><a href="#cb150-250" aria-hidden="true" tabindex="-1"></a><span class="co">#Regression model on age</span></span>
<span id="cb150-251"><a href="#cb150-251" aria-hidden="true" tabindex="-1"></a>mage <span class="ot">&lt;-</span> <span class="fu">glm</span>(diabetes <span class="sc">~</span> age, <span class="at">data =</span> train, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb150-252"><a href="#cb150-252" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mage)</span>
<span id="cb150-253"><a href="#cb150-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-254"><a href="#cb150-254" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(mage<span class="sc">$</span>coefficients)</span>
<span id="cb150-255"><a href="#cb150-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-256"><a href="#cb150-256" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> train, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> diabetes)) <span class="sc">+</span></span>
<span id="cb150-257"><a href="#cb150-257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span>.<span class="dv">5</span>, <span class="at">col=</span><span class="st">"coral"</span>) <span class="sc">+</span></span>
<span id="cb150-258"><a href="#cb150-258" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">'glm'</span>, <span class="at">se=</span><span class="cn">FALSE</span>, <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">family=</span>binomial))</span>
<span id="cb150-259"><a href="#cb150-259" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-260"><a href="#cb150-260" aria-hidden="true" tabindex="-1"></a>Interpretation: The exponentiation of the coefficient tells us that a 1-unit increase in age (years) multiplies the odds of diabetes by 1.037. The estimate shows us that one unit increase of age (1 year), increases the l Similar to the previous variable, age has a small standard error. It shows a p-value of 2.71e-06, indicating a relationship between age and diabetes. </span>
<span id="cb150-261"><a href="#cb150-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-262"><a href="#cb150-262" aria-hidden="true" tabindex="-1"></a>The hypothesis that BMI, glucose tolerance results, and age are positively associated with diabetes is supported. The small p-values show the variables are significant at 1% level of significance. We are able to reject the null hypothesis. Next, we can investigate models that could help predict the outcome using these variables. </span>
<span id="cb150-263"><a href="#cb150-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-264"><a href="#cb150-264" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model Comparisons</span></span>
<span id="cb150-265"><a href="#cb150-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-268"><a href="#cb150-268" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-269"><a href="#cb150-269" aria-hidden="true" tabindex="-1"></a><span class="co">#Model 1 using all independent variables - pregnancies, glucose, bmi, age</span></span>
<span id="cb150-270"><a href="#cb150-270" aria-hidden="true" tabindex="-1"></a>all_var <span class="ot">&lt;-</span> <span class="fu">glm</span>(diabetes <span class="sc">~</span> ., <span class="at">data =</span> train, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb150-271"><a href="#cb150-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-272"><a href="#cb150-272" aria-hidden="true" tabindex="-1"></a><span class="co">#Model 2 using BMI, glucose, and age</span></span>
<span id="cb150-273"><a href="#cb150-273" aria-hidden="true" tabindex="-1"></a>bga <span class="ot">&lt;-</span> <span class="fu">glm</span>(diabetes <span class="sc">~</span> . <span class="sc">-</span>pregnancies, <span class="at">data =</span> train, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb150-274"><a href="#cb150-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-275"><a href="#cb150-275" aria-hidden="true" tabindex="-1"></a><span class="co">#Model 3 using BMI and glucose</span></span>
<span id="cb150-276"><a href="#cb150-276" aria-hidden="true" tabindex="-1"></a>bg <span class="ot">&lt;-</span> <span class="fu">glm</span>(diabetes <span class="sc">~</span> .<span class="sc">-</span>age <span class="sc">-</span>pregnancies, <span class="at">data =</span> train, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb150-277"><a href="#cb150-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-278"><a href="#cb150-278" aria-hidden="true" tabindex="-1"></a><span class="co">#Model 4 using BMI, glucose, age, and an interaction between pregnancies and age.</span></span>
<span id="cb150-279"><a href="#cb150-279" aria-hidden="true" tabindex="-1"></a>ia <span class="ot">&lt;-</span> <span class="fu">glm</span>(diabetes <span class="sc">~</span> glucose <span class="sc">+</span> bmi <span class="sc">+</span> age<span class="sc">*</span>pregnancies, <span class="at">data =</span> train, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb150-280"><a href="#cb150-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-281"><a href="#cb150-281" aria-hidden="true" tabindex="-1"></a><span class="co">#Model 5 with BMI, glucose, and pregnancies (without age)</span></span>
<span id="cb150-282"><a href="#cb150-282" aria-hidden="true" tabindex="-1"></a>bgp <span class="ot">&lt;-</span> <span class="fu">glm</span>(diabetes <span class="sc">~</span> . <span class="sc">-</span>age, <span class="at">data =</span> train, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb150-283"><a href="#cb150-283" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-284"><a href="#cb150-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-285"><a href="#cb150-285" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model 1</span></span>
<span id="cb150-288"><a href="#cb150-288" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-289"><a href="#cb150-289" aria-hidden="true" tabindex="-1"></a><span class="co">#Summarize model including BMI, glucose, age, and pregnancies</span></span>
<span id="cb150-290"><a href="#cb150-290" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(all_var)</span>
<span id="cb150-291"><a href="#cb150-291" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-292"><a href="#cb150-292" aria-hidden="true" tabindex="-1"></a>We can see with the all variable model that pregnancies, glucose, and bmi have low p-values. That suggests those variables have a relationship with the outcome variable. </span>
<span id="cb150-293"><a href="#cb150-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-296"><a href="#cb150-296" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-297"><a href="#cb150-297" aria-hidden="true" tabindex="-1"></a><span class="co">#Find Odds ratios</span></span>
<span id="cb150-298"><a href="#cb150-298" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(all_var<span class="sc">$</span>coefficients)</span>
<span id="cb150-299"><a href="#cb150-299" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-300"><a href="#cb150-300" aria-hidden="true" tabindex="-1"></a>The odds ratio for pregnancies, glucose, bmi, and age are 1.130, 1.036, 1.085, and 1.013 respectively. They are all greater than 1, suggesting each variable increases the likelihood of the outcome variable. </span>
<span id="cb150-301"><a href="#cb150-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-304"><a href="#cb150-304" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-305"><a href="#cb150-305" aria-hidden="true" tabindex="-1"></a><span class="co">#Classify test set</span></span>
<span id="cb150-306"><a href="#cb150-306" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred_prob_mod1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(all_var, <span class="at">newdata =</span> test, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb150-307"><a href="#cb150-307" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred_class_mod1 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(test<span class="sc">$</span>pred_prob_mod1 <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb150-308"><a href="#cb150-308" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(test)</span>
<span id="cb150-309"><a href="#cb150-309" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-310"><a href="#cb150-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-313"><a href="#cb150-313" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-314"><a href="#cb150-314" aria-hidden="true" tabindex="-1"></a><span class="co">#Create confusion matrix</span></span>
<span id="cb150-315"><a href="#cb150-315" aria-hidden="true" tabindex="-1"></a>cm_mod1 <span class="ot">&lt;-</span> <span class="fu">table</span>(test<span class="sc">$</span>pred_class_mod1, test<span class="sc">$</span>diabetes)</span>
<span id="cb150-316"><a href="#cb150-316" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cm_mod1)</span>
<span id="cb150-317"><a href="#cb150-317" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-318"><a href="#cb150-318" aria-hidden="true" tabindex="-1"></a>The predicted outcomes are in rows and true outcomes in columns.</span>
<span id="cb150-319"><a href="#cb150-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-322"><a href="#cb150-322" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-323"><a href="#cb150-323" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculate precision, recall and F-score</span></span>
<span id="cb150-324"><a href="#cb150-324" aria-hidden="true" tabindex="-1"></a>tp1 <span class="ot">&lt;-</span> cm_mod1[<span class="dv">2</span>,<span class="dv">2</span>]</span>
<span id="cb150-325"><a href="#cb150-325" aria-hidden="true" tabindex="-1"></a>tn1 <span class="ot">&lt;-</span> cm_mod1[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb150-326"><a href="#cb150-326" aria-hidden="true" tabindex="-1"></a>fp1 <span class="ot">&lt;-</span> cm_mod1[<span class="dv">2</span>,<span class="dv">1</span>] </span>
<span id="cb150-327"><a href="#cb150-327" aria-hidden="true" tabindex="-1"></a>fn1 <span class="ot">&lt;-</span> cm_mod1[<span class="dv">1</span>,<span class="dv">2</span>] </span>
<span id="cb150-328"><a href="#cb150-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-329"><a href="#cb150-329" aria-hidden="true" tabindex="-1"></a>precision1 <span class="ot">&lt;-</span> tp1 <span class="sc">/</span> (tp1 <span class="sc">+</span> fp1)</span>
<span id="cb150-330"><a href="#cb150-330" aria-hidden="true" tabindex="-1"></a>recall1 <span class="ot">&lt;-</span> tp1 <span class="sc">/</span> (tp1 <span class="sc">+</span> fn1)</span>
<span id="cb150-331"><a href="#cb150-331" aria-hidden="true" tabindex="-1"></a>f1_score1 <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> ((precision1 <span class="sc">*</span> recall1 ) <span class="sc">/</span> (precision1 <span class="sc">+</span> recall1)) </span>
<span id="cb150-332"><a href="#cb150-332" aria-hidden="true" tabindex="-1"></a>accuracy1 <span class="ot">&lt;-</span> (tp1 <span class="sc">+</span> tn1) <span class="sc">/</span> (tp1 <span class="sc">+</span> tn1 <span class="sc">+</span> fp1 <span class="sc">+</span> fn1)</span>
<span id="cb150-333"><a href="#cb150-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-334"><a href="#cb150-334" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'Precision of Model 1:'</span>, precision1,<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb150-335"><a href="#cb150-335" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'Recall of Model 1:'</span>, recall1,<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb150-336"><a href="#cb150-336" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'F1 of Model 1:'</span>, f1_score1,<span class="st">'</span><span class="sc">\n</span><span class="st">'</span> )</span>
<span id="cb150-337"><a href="#cb150-337" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'Accuracy of Model 1:'</span>, accuracy1)</span>
<span id="cb150-338"><a href="#cb150-338" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-339"><a href="#cb150-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-342"><a href="#cb150-342" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-343"><a href="#cb150-343" aria-hidden="true" tabindex="-1"></a><span class="co">#Build ROC curve</span></span>
<span id="cb150-344"><a href="#cb150-344" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">roc</span>(test<span class="sc">$</span>diabetes <span class="sc">~</span> test<span class="sc">$</span>pred_prob_mod1), <span class="at">print.auc =</span> <span class="cn">TRUE</span>, <span class="at">legacy.axes=</span>T)</span>
<span id="cb150-345"><a href="#cb150-345" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-346"><a href="#cb150-346" aria-hidden="true" tabindex="-1"></a>The ROC curve a decent size with a area under the curve (AUC) of 0.842. Lets compare this model to our others as we go. </span>
<span id="cb150-347"><a href="#cb150-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-348"><a href="#cb150-348" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model 2</span></span>
<span id="cb150-349"><a href="#cb150-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-352"><a href="#cb150-352" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-353"><a href="#cb150-353" aria-hidden="true" tabindex="-1"></a><span class="co">#Summarize BMI, glucose, and age model</span></span>
<span id="cb150-354"><a href="#cb150-354" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bga)</span>
<span id="cb150-355"><a href="#cb150-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-356"><a href="#cb150-356" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(train, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span>bmi, <span class="at">color=</span>glucose)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">facet_grid</span>(<span class="sc">~</span>diabetes)</span>
<span id="cb150-357"><a href="#cb150-357" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-358"><a href="#cb150-358" aria-hidden="true" tabindex="-1"></a>The model looking at BMI, age, and glucose as explanatory variables for diabetes has an AIC of 526.6, which is a worse fit than the all variables model. </span>
<span id="cb150-359"><a href="#cb150-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-362"><a href="#cb150-362" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-363"><a href="#cb150-363" aria-hidden="true" tabindex="-1"></a><span class="co">#Find Odds ratios</span></span>
<span id="cb150-364"><a href="#cb150-364" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(bga<span class="sc">$</span>coefficients)</span>
<span id="cb150-365"><a href="#cb150-365" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-366"><a href="#cb150-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-369"><a href="#cb150-369" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-370"><a href="#cb150-370" aria-hidden="true" tabindex="-1"></a><span class="co">#Classify test set</span></span>
<span id="cb150-371"><a href="#cb150-371" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred_prob_mod2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(bga, <span class="at">newdata =</span> test, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb150-372"><a href="#cb150-372" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred_class_mod2 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(test<span class="sc">$</span>pred_prob_mod2 <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb150-373"><a href="#cb150-373" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-374"><a href="#cb150-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-377"><a href="#cb150-377" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-378"><a href="#cb150-378" aria-hidden="true" tabindex="-1"></a><span class="co">#Create confusion matrix</span></span>
<span id="cb150-379"><a href="#cb150-379" aria-hidden="true" tabindex="-1"></a>cm_mod2 <span class="ot">&lt;-</span> <span class="fu">table</span>(test<span class="sc">$</span>pred_class_mod2, test<span class="sc">$</span>diabetes)</span>
<span id="cb150-380"><a href="#cb150-380" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cm_mod2)</span>
<span id="cb150-381"><a href="#cb150-381" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-382"><a href="#cb150-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-385"><a href="#cb150-385" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-386"><a href="#cb150-386" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculate precision, recall and F-score</span></span>
<span id="cb150-387"><a href="#cb150-387" aria-hidden="true" tabindex="-1"></a>tp2 <span class="ot">&lt;-</span> cm_mod2[<span class="dv">2</span>,<span class="dv">2</span>]</span>
<span id="cb150-388"><a href="#cb150-388" aria-hidden="true" tabindex="-1"></a>tn2 <span class="ot">&lt;-</span> cm_mod2[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb150-389"><a href="#cb150-389" aria-hidden="true" tabindex="-1"></a>fp2 <span class="ot">&lt;-</span> cm_mod2[<span class="dv">2</span>,<span class="dv">1</span>] </span>
<span id="cb150-390"><a href="#cb150-390" aria-hidden="true" tabindex="-1"></a>fn2 <span class="ot">&lt;-</span> cm_mod2[<span class="dv">1</span>,<span class="dv">2</span>] </span>
<span id="cb150-391"><a href="#cb150-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-392"><a href="#cb150-392" aria-hidden="true" tabindex="-1"></a>precision2 <span class="ot">&lt;-</span> tp2 <span class="sc">/</span> (tp2 <span class="sc">+</span> fp2)</span>
<span id="cb150-393"><a href="#cb150-393" aria-hidden="true" tabindex="-1"></a>recall2 <span class="ot">&lt;-</span> tp2 <span class="sc">/</span> (tp2 <span class="sc">+</span> fn2)</span>
<span id="cb150-394"><a href="#cb150-394" aria-hidden="true" tabindex="-1"></a>f1_score2 <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> ((precision2 <span class="sc">*</span> recall2 ) <span class="sc">/</span> (precision2 <span class="sc">+</span> recall2)) </span>
<span id="cb150-395"><a href="#cb150-395" aria-hidden="true" tabindex="-1"></a>accuracy2 <span class="ot">&lt;-</span> (tp2 <span class="sc">+</span> tn2) <span class="sc">/</span> (tp2 <span class="sc">+</span> tn2 <span class="sc">+</span> fp2 <span class="sc">+</span> fn2)</span>
<span id="cb150-396"><a href="#cb150-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-397"><a href="#cb150-397" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'Precision of Model 2:'</span>, precision2,<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb150-398"><a href="#cb150-398" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'Recall of Model 2:'</span>, recall2,<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb150-399"><a href="#cb150-399" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'F1 of Model 2:'</span>, f1_score2,<span class="st">'</span><span class="sc">\n</span><span class="st">'</span> )</span>
<span id="cb150-400"><a href="#cb150-400" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'Accuracy of Model 2:'</span>, accuracy2)</span>
<span id="cb150-401"><a href="#cb150-401" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-404"><a href="#cb150-404" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-405"><a href="#cb150-405" aria-hidden="true" tabindex="-1"></a><span class="co">#Build ROC curve</span></span>
<span id="cb150-406"><a href="#cb150-406" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">roc</span>(test<span class="sc">$</span>diabetes <span class="sc">~</span> test<span class="sc">$</span>pred_prob_mod2), <span class="at">print.auc =</span> <span class="cn">TRUE</span>, <span class="at">legacy.axes=</span>T)</span>
<span id="cb150-407"><a href="#cb150-407" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-408"><a href="#cb150-408" aria-hidden="true" tabindex="-1"></a>Model 2 presents an AUC of 0.846, slightly bigger than model 1. It does become starkly less smooth around 0.6 on the y axis, sensitivity. Let's see if the any other models present this way.</span>
<span id="cb150-409"><a href="#cb150-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-410"><a href="#cb150-410" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model 3 </span></span>
<span id="cb150-411"><a href="#cb150-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-414"><a href="#cb150-414" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-415"><a href="#cb150-415" aria-hidden="true" tabindex="-1"></a><span class="co">#Summarize BMI and glucose model</span></span>
<span id="cb150-416"><a href="#cb150-416" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bg)</span>
<span id="cb150-417"><a href="#cb150-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-418"><a href="#cb150-418" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(train, <span class="fu">aes</span>(<span class="at">x=</span>glucose, <span class="at">y=</span>bmi, <span class="at">color=</span>diabetes)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">facet_grid</span>(<span class="sc">~</span>diabetes)</span>
<span id="cb150-419"><a href="#cb150-419" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-420"><a href="#cb150-420" aria-hidden="true" tabindex="-1"></a>This BMI and glucose only model has a worse (higher) AIC, with 536.8, than the 2 previous models. So far, the all variable model appears the best fit. </span>
<span id="cb150-421"><a href="#cb150-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-424"><a href="#cb150-424" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-425"><a href="#cb150-425" aria-hidden="true" tabindex="-1"></a><span class="co">#Find Odds ratios</span></span>
<span id="cb150-426"><a href="#cb150-426" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(bg<span class="sc">$</span>coefficients)</span>
<span id="cb150-427"><a href="#cb150-427" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-428"><a href="#cb150-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-431"><a href="#cb150-431" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-432"><a href="#cb150-432" aria-hidden="true" tabindex="-1"></a><span class="co">#Classify test set</span></span>
<span id="cb150-433"><a href="#cb150-433" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred_prob_mod3 <span class="ot">&lt;-</span> <span class="fu">predict</span>(bg, <span class="at">newdata =</span> test, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb150-434"><a href="#cb150-434" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred_class_mod3 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(test<span class="sc">$</span>pred_prob_mod3 <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb150-435"><a href="#cb150-435" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-436"><a href="#cb150-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-439"><a href="#cb150-439" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-440"><a href="#cb150-440" aria-hidden="true" tabindex="-1"></a><span class="co">#Create confusion matrix</span></span>
<span id="cb150-441"><a href="#cb150-441" aria-hidden="true" tabindex="-1"></a>cm_mod3 <span class="ot">&lt;-</span> <span class="fu">table</span>(test<span class="sc">$</span>pred_class_mod3, test<span class="sc">$</span>diabetes)</span>
<span id="cb150-442"><a href="#cb150-442" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cm_mod3)</span>
<span id="cb150-443"><a href="#cb150-443" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-446"><a href="#cb150-446" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-447"><a href="#cb150-447" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculate precision, recall and F-score</span></span>
<span id="cb150-448"><a href="#cb150-448" aria-hidden="true" tabindex="-1"></a>tp3 <span class="ot">&lt;-</span> cm_mod3[<span class="dv">2</span>,<span class="dv">2</span>]</span>
<span id="cb150-449"><a href="#cb150-449" aria-hidden="true" tabindex="-1"></a>tn3 <span class="ot">&lt;-</span> cm_mod3[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb150-450"><a href="#cb150-450" aria-hidden="true" tabindex="-1"></a>fp3 <span class="ot">&lt;-</span> cm_mod3[<span class="dv">2</span>,<span class="dv">1</span>] </span>
<span id="cb150-451"><a href="#cb150-451" aria-hidden="true" tabindex="-1"></a>fn3 <span class="ot">&lt;-</span> cm_mod3[<span class="dv">1</span>,<span class="dv">2</span>] </span>
<span id="cb150-452"><a href="#cb150-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-453"><a href="#cb150-453" aria-hidden="true" tabindex="-1"></a>precision3 <span class="ot">&lt;-</span> tp3 <span class="sc">/</span> (tp3 <span class="sc">+</span> fp3)</span>
<span id="cb150-454"><a href="#cb150-454" aria-hidden="true" tabindex="-1"></a>recall3 <span class="ot">&lt;-</span> tp3 <span class="sc">/</span> (tp3 <span class="sc">+</span> fn3)</span>
<span id="cb150-455"><a href="#cb150-455" aria-hidden="true" tabindex="-1"></a>f1_score3 <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> ((precision3 <span class="sc">*</span> recall3 ) <span class="sc">/</span> (precision3 <span class="sc">+</span> recall3)) </span>
<span id="cb150-456"><a href="#cb150-456" aria-hidden="true" tabindex="-1"></a>accuracy3 <span class="ot">&lt;-</span> (tp3 <span class="sc">+</span> tn3) <span class="sc">/</span> (tp3 <span class="sc">+</span> tn3 <span class="sc">+</span> fp3 <span class="sc">+</span> fn3)</span>
<span id="cb150-457"><a href="#cb150-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-458"><a href="#cb150-458" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'Precision of Model 3:'</span>, precision3,<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb150-459"><a href="#cb150-459" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'Recall of Model 3:'</span>, recall3,<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb150-460"><a href="#cb150-460" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'F1 of Model 3:'</span>, f1_score3,<span class="st">'</span><span class="sc">\n</span><span class="st">'</span> )</span>
<span id="cb150-461"><a href="#cb150-461" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'Accuracy of Model 3:'</span>, accuracy3)</span>
<span id="cb150-462"><a href="#cb150-462" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-463"><a href="#cb150-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-466"><a href="#cb150-466" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-467"><a href="#cb150-467" aria-hidden="true" tabindex="-1"></a><span class="co">#Build ROC curve</span></span>
<span id="cb150-468"><a href="#cb150-468" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">roc</span>(test<span class="sc">$</span>diabetes <span class="sc">~</span> test<span class="sc">$</span>pred_prob_mod3), <span class="at">print.auc =</span> <span class="cn">TRUE</span>, <span class="at">legacy.axes=</span>T)</span>
<span id="cb150-469"><a href="#cb150-469" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-470"><a href="#cb150-470" aria-hidden="true" tabindex="-1"></a>Model 3 has a lower AUC (0.840) than model 1 (0.842) and model 2 (0.846).</span>
<span id="cb150-471"><a href="#cb150-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-472"><a href="#cb150-472" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model 4</span></span>
<span id="cb150-473"><a href="#cb150-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-476"><a href="#cb150-476" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-477"><a href="#cb150-477" aria-hidden="true" tabindex="-1"></a><span class="co">#Summarize model including interaction between age and pregnancies </span></span>
<span id="cb150-478"><a href="#cb150-478" aria-hidden="true" tabindex="-1"></a><span class="co">#This was chosen to see if the impact of age on diabetes is different depending on the number of pregnancies</span></span>
<span id="cb150-479"><a href="#cb150-479" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ia)</span>
<span id="cb150-480"><a href="#cb150-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-481"><a href="#cb150-481" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(train, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span>bmi, <span class="at">color=</span>pregnancies)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">facet_grid</span>(<span class="sc">~</span>diabetes)</span>
<span id="cb150-482"><a href="#cb150-482" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-483"><a href="#cb150-483" aria-hidden="true" tabindex="-1"></a>With an AIC of 510.41, this model appears to be the best fit model of those we have compared. This indicated there is an interaction between age and pregnancies that has a relationship with the outcome variable. </span>
<span id="cb150-484"><a href="#cb150-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-487"><a href="#cb150-487" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-488"><a href="#cb150-488" aria-hidden="true" tabindex="-1"></a><span class="co">#Find Odds ratios</span></span>
<span id="cb150-489"><a href="#cb150-489" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(ia<span class="sc">$</span>coefficients)</span>
<span id="cb150-490"><a href="#cb150-490" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-491"><a href="#cb150-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-494"><a href="#cb150-494" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-495"><a href="#cb150-495" aria-hidden="true" tabindex="-1"></a><span class="co">#Classify test set</span></span>
<span id="cb150-496"><a href="#cb150-496" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred_prob_mod4 <span class="ot">&lt;-</span> <span class="fu">predict</span>(ia, <span class="at">newdata =</span> test, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb150-497"><a href="#cb150-497" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred_class_mod4 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(test<span class="sc">$</span>pred_prob_mod4 <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb150-498"><a href="#cb150-498" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-499"><a href="#cb150-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-502"><a href="#cb150-502" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-503"><a href="#cb150-503" aria-hidden="true" tabindex="-1"></a><span class="co">#Create confusion matrix</span></span>
<span id="cb150-504"><a href="#cb150-504" aria-hidden="true" tabindex="-1"></a>cm_mod4 <span class="ot">&lt;-</span> <span class="fu">table</span>(test<span class="sc">$</span>pred_class_mod4, test<span class="sc">$</span>diabetes)</span>
<span id="cb150-505"><a href="#cb150-505" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cm_mod4)</span>
<span id="cb150-506"><a href="#cb150-506" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-509"><a href="#cb150-509" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-510"><a href="#cb150-510" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculate precision, recall and F-score</span></span>
<span id="cb150-511"><a href="#cb150-511" aria-hidden="true" tabindex="-1"></a>tp4 <span class="ot">&lt;-</span> cm_mod4[<span class="dv">2</span>,<span class="dv">2</span>]</span>
<span id="cb150-512"><a href="#cb150-512" aria-hidden="true" tabindex="-1"></a>tn4 <span class="ot">&lt;-</span> cm_mod4[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb150-513"><a href="#cb150-513" aria-hidden="true" tabindex="-1"></a>fp4 <span class="ot">&lt;-</span> cm_mod4[<span class="dv">2</span>,<span class="dv">1</span>] </span>
<span id="cb150-514"><a href="#cb150-514" aria-hidden="true" tabindex="-1"></a>fn4 <span class="ot">&lt;-</span> cm_mod4[<span class="dv">1</span>,<span class="dv">2</span>] </span>
<span id="cb150-515"><a href="#cb150-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-516"><a href="#cb150-516" aria-hidden="true" tabindex="-1"></a>precision4 <span class="ot">&lt;-</span> tp4 <span class="sc">/</span> (tp4 <span class="sc">+</span> fp4)</span>
<span id="cb150-517"><a href="#cb150-517" aria-hidden="true" tabindex="-1"></a>recall4 <span class="ot">&lt;-</span> tp4 <span class="sc">/</span> (tp4 <span class="sc">+</span> fn4)</span>
<span id="cb150-518"><a href="#cb150-518" aria-hidden="true" tabindex="-1"></a>f1_score4 <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> ((precision4 <span class="sc">*</span> recall4 ) <span class="sc">/</span> (precision4 <span class="sc">+</span> recall4)) </span>
<span id="cb150-519"><a href="#cb150-519" aria-hidden="true" tabindex="-1"></a>accuracy4 <span class="ot">&lt;-</span> (tp4 <span class="sc">+</span> tn4) <span class="sc">/</span> (tp4 <span class="sc">+</span> tn4 <span class="sc">+</span> fp4 <span class="sc">+</span> fn4)</span>
<span id="cb150-520"><a href="#cb150-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-521"><a href="#cb150-521" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'Precision of Model 4:'</span>, precision4,<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb150-522"><a href="#cb150-522" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'Recall of Model 4:'</span>, recall4,<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb150-523"><a href="#cb150-523" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'F1 of Model 4:'</span>, f1_score4,<span class="st">'</span><span class="sc">\n</span><span class="st">'</span> )</span>
<span id="cb150-524"><a href="#cb150-524" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'Accuracy of Model 4:'</span>, accuracy4)</span>
<span id="cb150-525"><a href="#cb150-525" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-526"><a href="#cb150-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-529"><a href="#cb150-529" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-530"><a href="#cb150-530" aria-hidden="true" tabindex="-1"></a><span class="co">#Build ROC curve</span></span>
<span id="cb150-531"><a href="#cb150-531" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">roc</span>(test<span class="sc">$</span>diabetes <span class="sc">~</span> test<span class="sc">$</span>pred_prob_mod4), <span class="at">print.auc =</span> <span class="cn">TRUE</span>, <span class="at">legacy.axes=</span>T)</span>
<span id="cb150-532"><a href="#cb150-532" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-533"><a href="#cb150-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-534"><a href="#cb150-534" aria-hidden="true" tabindex="-1"></a>Model 4 has similar AUC to 1 and 3. </span>
<span id="cb150-535"><a href="#cb150-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-536"><a href="#cb150-536" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model 5 </span></span>
<span id="cb150-537"><a href="#cb150-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-540"><a href="#cb150-540" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-541"><a href="#cb150-541" aria-hidden="true" tabindex="-1"></a><span class="co">#Summarize model including without age</span></span>
<span id="cb150-542"><a href="#cb150-542" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bgp)</span>
<span id="cb150-543"><a href="#cb150-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-544"><a href="#cb150-544" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(train, <span class="fu">aes</span>(<span class="at">x=</span>pregnancies, <span class="at">y=</span>bmi, <span class="at">color=</span>glucose)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">facet_grid</span>(<span class="sc">~</span>diabetes)</span>
<span id="cb150-545"><a href="#cb150-545" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-546"><a href="#cb150-546" aria-hidden="true" tabindex="-1"></a>Removing age entirely increased the AIC of this model. So, the interaction model seems to be the best fit. That is, model 4 which includes BMI and glucose and controls for an interaction between age and pregnancy has the best fit of all models tested. </span>
<span id="cb150-547"><a href="#cb150-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-550"><a href="#cb150-550" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-551"><a href="#cb150-551" aria-hidden="true" tabindex="-1"></a><span class="co">#Find Odds ratios</span></span>
<span id="cb150-552"><a href="#cb150-552" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(bgp<span class="sc">$</span>coefficients)</span>
<span id="cb150-553"><a href="#cb150-553" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-554"><a href="#cb150-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-557"><a href="#cb150-557" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-558"><a href="#cb150-558" aria-hidden="true" tabindex="-1"></a><span class="co">#Classify test set</span></span>
<span id="cb150-559"><a href="#cb150-559" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred_prob_mod5 <span class="ot">&lt;-</span> <span class="fu">predict</span>(bgp, <span class="at">newdata =</span> test, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb150-560"><a href="#cb150-560" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred_class_mod5 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(test<span class="sc">$</span>pred_prob_mod5 <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb150-561"><a href="#cb150-561" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-562"><a href="#cb150-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-565"><a href="#cb150-565" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-566"><a href="#cb150-566" aria-hidden="true" tabindex="-1"></a><span class="co">#Create confusion matrix</span></span>
<span id="cb150-567"><a href="#cb150-567" aria-hidden="true" tabindex="-1"></a>cm_mod5 <span class="ot">&lt;-</span> <span class="fu">table</span>(test<span class="sc">$</span>pred_class_mod5, test<span class="sc">$</span>diabetes)</span>
<span id="cb150-568"><a href="#cb150-568" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cm_mod5)</span>
<span id="cb150-569"><a href="#cb150-569" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-570"><a href="#cb150-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-573"><a href="#cb150-573" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-574"><a href="#cb150-574" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculate precision, recall and F-score</span></span>
<span id="cb150-575"><a href="#cb150-575" aria-hidden="true" tabindex="-1"></a>tp5 <span class="ot">&lt;-</span> cm_mod5[<span class="dv">2</span>,<span class="dv">2</span>]</span>
<span id="cb150-576"><a href="#cb150-576" aria-hidden="true" tabindex="-1"></a>tn5 <span class="ot">&lt;-</span> cm_mod5[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb150-577"><a href="#cb150-577" aria-hidden="true" tabindex="-1"></a>fp5 <span class="ot">&lt;-</span> cm_mod5[<span class="dv">2</span>,<span class="dv">1</span>] </span>
<span id="cb150-578"><a href="#cb150-578" aria-hidden="true" tabindex="-1"></a>fn5 <span class="ot">&lt;-</span> cm_mod5[<span class="dv">1</span>,<span class="dv">2</span>] </span>
<span id="cb150-579"><a href="#cb150-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-580"><a href="#cb150-580" aria-hidden="true" tabindex="-1"></a>precision5 <span class="ot">&lt;-</span> tp5 <span class="sc">/</span> (tp5 <span class="sc">+</span> fp5)</span>
<span id="cb150-581"><a href="#cb150-581" aria-hidden="true" tabindex="-1"></a>recall5 <span class="ot">&lt;-</span> tp5 <span class="sc">/</span> (tp5 <span class="sc">+</span> fn5)</span>
<span id="cb150-582"><a href="#cb150-582" aria-hidden="true" tabindex="-1"></a>f1_score5 <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> ((precision5 <span class="sc">*</span> recall5 ) <span class="sc">/</span> (precision5 <span class="sc">+</span> recall5)) </span>
<span id="cb150-583"><a href="#cb150-583" aria-hidden="true" tabindex="-1"></a>accuracy5 <span class="ot">&lt;-</span> (tp5 <span class="sc">+</span> tn5) <span class="sc">/</span> (tp5 <span class="sc">+</span> tn5 <span class="sc">+</span> fp5 <span class="sc">+</span> fn5)</span>
<span id="cb150-584"><a href="#cb150-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-585"><a href="#cb150-585" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'Precision of Model 5:'</span>, precision5,<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb150-586"><a href="#cb150-586" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'Recall of Model5:'</span>, recall5,<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb150-587"><a href="#cb150-587" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'F1 of Model 5:'</span>, f1_score5,<span class="st">'</span><span class="sc">\n</span><span class="st">'</span> )</span>
<span id="cb150-588"><a href="#cb150-588" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'Accuracy of Model 5:'</span>, accuracy5)</span>
<span id="cb150-589"><a href="#cb150-589" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-590"><a href="#cb150-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-591"><a href="#cb150-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-594"><a href="#cb150-594" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-595"><a href="#cb150-595" aria-hidden="true" tabindex="-1"></a><span class="co">#Build ROC curve</span></span>
<span id="cb150-596"><a href="#cb150-596" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">roc</span>(test<span class="sc">$</span>diabetes <span class="sc">~</span> test<span class="sc">$</span>pred_prob_mod5), <span class="at">print.auc =</span> <span class="cn">TRUE</span>, <span class="at">legacy.axes=</span>T)</span>
<span id="cb150-597"><a href="#cb150-597" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-598"><a href="#cb150-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-599"><a href="#cb150-599" aria-hidden="true" tabindex="-1"></a><span class="fu">### Choosing a model:</span></span>
<span id="cb150-600"><a href="#cb150-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-603"><a href="#cb150-603" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb150-604"><a href="#cb150-604" aria-hidden="true" tabindex="-1"></a><span class="co">#Create table to compare models</span></span>
<span id="cb150-605"><a href="#cb150-605" aria-hidden="true" tabindex="-1"></a>auc1<span class="ot">&lt;-</span>(<span class="fl">0.842</span>)</span>
<span id="cb150-606"><a href="#cb150-606" aria-hidden="true" tabindex="-1"></a>auc2<span class="ot">&lt;-</span>(<span class="fl">0.846</span>)</span>
<span id="cb150-607"><a href="#cb150-607" aria-hidden="true" tabindex="-1"></a>auc3<span class="ot">&lt;-</span>(<span class="fl">0.840</span>)</span>
<span id="cb150-608"><a href="#cb150-608" aria-hidden="true" tabindex="-1"></a>auc4<span class="ot">&lt;-</span>(<span class="fl">0.841</span>)</span>
<span id="cb150-609"><a href="#cb150-609" aria-hidden="true" tabindex="-1"></a>auc5<span class="ot">&lt;-</span>(<span class="fl">0.838</span>)</span>
<span id="cb150-610"><a href="#cb150-610" aria-hidden="true" tabindex="-1"></a>comp_mods <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(accuracy1, accuracy2, accuracy3, accuracy4, accuracy5, f1_score1, f1_score2, f1_score3, f1_score4, f1_score5, recall1, recall2, recall3, recall4, recall5, precision1, precision2, precision3, precision4, precision5, auc1, auc2, auc3, auc4, auc5), <span class="at">ncol=</span><span class="dv">5</span>, <span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb150-611"><a href="#cb150-611" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(comp_mods) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Model 1'</span>,<span class="st">'Model 2'</span>,<span class="st">'Model 3'</span>, <span class="st">'Model4'</span>, <span class="st">'Model5'</span>)</span>
<span id="cb150-612"><a href="#cb150-612" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(comp_mods) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Accuracy'</span>,<span class="st">'F1 Score'</span>,<span class="st">'Recall'</span>, <span class="st">'Prescision'</span>, <span class="st">'AUC'</span>)</span>
<span id="cb150-613"><a href="#cb150-613" aria-hidden="true" tabindex="-1"></a>comp_mods <span class="ot">&lt;-</span> <span class="fu">as.table</span>(comp_mods)</span>
<span id="cb150-614"><a href="#cb150-614" aria-hidden="true" tabindex="-1"></a>comp_mods</span>
<span id="cb150-615"><a href="#cb150-615" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb150-616"><a href="#cb150-616" aria-hidden="true" tabindex="-1"></a>Model 3 has the highest accuracy, with 2 close behind it. The F1 score, which is the harmonic mean, takes both recall and precision into account. Model 2 has the highest F1 score with Model 3 close behind. Model 2 also has the highest AUC. Model 2, which used BMI, glucose, and age as predictor values for diabetes, looks like the best fit. </span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>